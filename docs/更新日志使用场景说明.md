# 更新日志使用场景说明

## 🤔 应该在本地用，还是在云服务器用？

### 推荐：在云服务器使用 ✅

**原因：**
1. 更新日志是给生产用户看的，应该直接写入生产数据库
2. 本地数据库和生产数据库是分开的，本地创建不会影响生产用户
3. 云服务器上操作更安全，可以控制访问权限

---

## 📍 使用场景对比

### 场景一：在云服务器使用（推荐）⭐

**适用情况：**
- 发布新版本给用户
- 更新生产环境的更新日志
- 正式发布更新内容

**操作步骤：**

1. **SSH 连接到云服务器**
```bash
ssh user@your-server-ip
```

2. **进入项目目录**
```bash
cd /path/to/your/project
```

3. **设置 API 地址（如果需要）**
```bash
# 如果后端在本地运行，使用 localhost
export API_BASE_URL=http://localhost:8000

# 如果后端在其他服务器，使用服务器 IP
export API_BASE_URL=http://123.456.789.0:8000

# 如果使用域名
export API_BASE_URL=https://api.yourdomain.com
```

4. **运行脚本**
```bash
cd npc-backend
npm run changelog:create
```

**优点：**
- ✅ 直接写入生产数据库
- ✅ 用户立即能看到更新
- ✅ 不需要同步数据

---

### 场景二：在本地使用（开发测试）

**适用情况：**
- 测试更新日志功能
- 开发环境调试
- 本地预览效果

**操作步骤：**

1. **确保本地后端运行**
```bash
cd npc-backend
npm run dev
```

2. **运行脚本**
```bash
npm run changelog:create
```

**注意：**
- ⚠️ 本地创建的更新日志只在本地数据库，生产用户看不到
- ⚠️ 如果要在生产环境生效，需要同步到生产数据库

---

## 🔧 配置方法

### 方法一：使用环境变量（推荐）

**在云服务器上：**

```bash
# 设置 API 地址（根据你的实际情况）
export API_BASE_URL=http://localhost:8000  # 如果后端在同一服务器
# 或
export API_BASE_URL=http://123.456.789.0:8000  # 如果后端在其他服务器

# 设置管理员账号（可选，不设置会提示输入）
export ADMIN_USER_ID=admin
export ADMIN_PASSWORD=your_password

# 运行脚本
cd npc-backend
npm run changelog:create
```

**在本地：**

```bash
# 默认使用 localhost:8000，无需设置
cd npc-backend
npm run changelog:create
```

### 方法二：直接修改脚本中的默认值

编辑 `npc-backend/scripts/create-changelog.js`：

```javascript
// 修改这里的默认值
const API_BASE_URL = process.env.API_BASE_URL || 'http://你的服务器IP:8000';
const DEFAULT_USER_ID = process.env.ADMIN_USER_ID || 'admin';
const DEFAULT_PASSWORD = process.env.ADMIN_PASSWORD || 'your_password';
```

---

## 🎯 推荐工作流程

### 发布新版本时的完整流程：

1. **在云服务器上创建更新日志**
```bash
# SSH 到服务器
ssh user@your-server-ip

# 进入项目目录
cd /path/to/project/npc-backend

# 设置环境变量（如果需要）
export API_BASE_URL=http://localhost:8000

# 创建更新日志
npm run changelog:create
```

2. **验证更新日志**
```bash
# 查看所有版本
curl http://localhost:8000/api/v1/versions

# 或查看数据库
docker-compose exec mysql mysql -u root -p npc_db
# 然后执行：
SELECT version, title, release_date, is_active FROM version_changelogs ORDER BY version DESC;
```

3. **用户登录时会自动看到更新提示** ✅

---

## 💡 快速判断：我应该在哪里用？

| 场景 | 使用位置 | 原因 |
|------|---------|------|
| 发布新版本给用户 | **云服务器** ✅ | 直接写入生产数据库 |
| 测试更新日志功能 | 本地 | 不影响生产环境 |
| 修复更新日志内容 | **云服务器** ✅ | 更新生产数据 |
| 开发调试 | 本地 | 快速测试 |

---

## 🚨 注意事项

1. **数据库连接**
   - 脚本通过 API 创建更新日志，不需要直接连接数据库
   - 确保 API 地址正确（本地用 localhost，生产用服务器 IP）

2. **权限问题**
   - 需要管理员账号才能创建更新日志
   - 确保账号有权限访问 API

3. **网络问题**
   - 如果在本地操作生产服务器，确保网络可达
   - 可以使用 SSH 隧道或 VPN

4. **数据同步**
   - 本地创建的更新日志不会自动同步到生产
   - 如果误在本地创建，需要手动同步或重新在生产创建

---

## 📝 总结

**最佳实践：**
- ✅ **在云服务器上创建更新日志**（推荐）
- ✅ 使用环境变量配置 API 地址
- ✅ 创建后立即验证
- ✅ 用户登录时会自动看到更新提示

**快速命令（云服务器）：**
```bash
cd npc-backend
export API_BASE_URL=http://localhost:8000  # 根据实际情况修改
npm run changelog:create
```

