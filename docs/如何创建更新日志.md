# å¦‚ä½•åˆ›å»ºæ›´æ–°æ—¥å¿—

## ğŸ“ æ¦‚è¿°

é¡¹ç›®ä½¿ç”¨æ•°æ®åº“å­˜å‚¨æ›´æ–°æ—¥å¿—ï¼Œæ”¯æŒé€šè¿‡ API æˆ– SQL ç›´æ¥åˆ›å»ºã€‚æ›´æ–°æ—¥å¿—ä¼šåœ¨ç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨æ˜¾ç¤ºï¼ˆå¦‚æœç‰ˆæœ¬å·æ›´æ–°ï¼‰ã€‚

---

## ğŸš€ æ–¹æ³•ä¸€ï¼šé€šè¿‡ API åˆ›å»ºï¼ˆæ¨èï¼‰

### 1. ä½¿ç”¨ curl å‘½ä»¤

```bash
# å…ˆç™»å½•è·å– tokenï¼ˆæ›¿æ¢ä¸ºä½ çš„ç”¨æˆ·åå’Œå¯†ç ï¼‰
TOKEN=$(curl -X POST http://localhost:8000/api/v1/users/login \
  -H "Content-Type: application/json" \
  -d '{"username":"your_username","password":"your_password"}' \
  | jq -r '.data.token')

# åˆ›å»ºæ›´æ–°æ—¥å¿—
curl -X POST http://localhost:8000/api/v1/versions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "version": "1.6.0",
    "title": "v1.6.0 ç‰ˆæœ¬æ›´æ–°",
    "content": "## æ›´æ–°å†…å®¹\n\næœ¬æ¬¡æ›´æ–°å¸¦æ¥äº†ä»¥ä¸‹æ”¹è¿›ï¼š\n\n### âœ¨ æ–°å¢åŠŸèƒ½\n- æ–°å¢åŠŸèƒ½A\n- æ–°å¢åŠŸèƒ½B\n\n### ğŸ› é—®é¢˜ä¿®å¤\n- ä¿®å¤äº†é—®é¢˜X\n- ä¿®å¤äº†é—®é¢˜Y\n\n### âš¡ æ€§èƒ½ä¼˜åŒ–\n- ä¼˜åŒ–äº†æ€§èƒ½Z",
    "releaseDate": "2025-12-01",
    "isActive": true
  }'
```

### 2. ä½¿ç”¨ Postman æˆ–å…¶ä»– API å·¥å…·

**è¯·æ±‚ä¿¡æ¯ï¼š**
- **URL**: `POST http://localhost:8000/api/v1/versions`
- **Headers**: 
  - `Content-Type: application/json`
  - `Authorization: Bearer <ä½ çš„token>`
- **Body** (JSON):
```json
{
  "version": "1.6.0",
  "title": "v1.6.0 ç‰ˆæœ¬æ›´æ–°",
  "content": "## æ›´æ–°å†…å®¹\n\næœ¬æ¬¡æ›´æ–°å¸¦æ¥äº†ä»¥ä¸‹æ”¹è¿›ï¼š\n\n### âœ¨ æ–°å¢åŠŸèƒ½\n- æ–°å¢åŠŸèƒ½A\n- æ–°å¢åŠŸèƒ½B\n\n### ğŸ› é—®é¢˜ä¿®å¤\n- ä¿®å¤äº†é—®é¢˜X\n\n### âš¡ æ€§èƒ½ä¼˜åŒ–\n- ä¼˜åŒ–äº†æ€§èƒ½Z",
  "releaseDate": "2025-12-01",
  "isActive": true
}
```

---

## ğŸ—„ï¸ æ–¹æ³•äºŒï¼šç›´æ¥ä½¿ç”¨ SQL

### 1. è¿æ¥åˆ°æ•°æ®åº“

```bash
# ä½¿ç”¨ Docker
docker-compose exec mysql mysql -u root -p npc_db

# æˆ–ç›´æ¥è¿æ¥
mysql -u root -p npc_db
```

### 2. æ‰§è¡Œ INSERT è¯­å¥

```sql
INSERT INTO version_changelogs 
  (version, title, content, release_date, is_active, created_at, updated_at)
VALUES (
  '1.6.0',                                    -- ç‰ˆæœ¬å·
  'v1.6.0 ç‰ˆæœ¬æ›´æ–°',                          -- æ ‡é¢˜
  '## æ›´æ–°å†…å®¹

æœ¬æ¬¡æ›´æ–°å¸¦æ¥äº†ä»¥ä¸‹æ”¹è¿›ï¼š

### âœ¨ æ–°å¢åŠŸèƒ½
- æ–°å¢åŠŸèƒ½A
- æ–°å¢åŠŸèƒ½B

### ğŸ› é—®é¢˜ä¿®å¤
- ä¿®å¤äº†é—®é¢˜X
- ä¿®å¤äº†é—®é¢˜Y

### âš¡ æ€§èƒ½ä¼˜åŒ–
- ä¼˜åŒ–äº†æ€§èƒ½Z',                              -- å†…å®¹ï¼ˆMarkdownæ ¼å¼ï¼‰
  '2025-12-01',                               -- å‘å¸ƒæ—¥æœŸ
  1,                                          -- æ˜¯å¦æ¿€æ´»ï¼ˆ1=æ¿€æ´»ï¼Œ0=ç¦ç”¨ï¼‰
  UNIX_TIMESTAMP() * 1000,                    -- åˆ›å»ºæ—¶é—´æˆ³
  UNIX_TIMESTAMP() * 1000                     -- æ›´æ–°æ—¶é—´æˆ³
);
```

---

## ğŸ“‹ å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|------|
| `version` | string | âœ… | ç‰ˆæœ¬å·ï¼ˆå”¯ä¸€ï¼‰ | `"1.6.0"` |
| `title` | string | âœ… | æ›´æ–°æ ‡é¢˜ | `"v1.6.0 ç‰ˆæœ¬æ›´æ–°"` |
| `content` | string | âŒ | æ›´æ–°å†…å®¹ï¼ˆMarkdownæ ¼å¼ï¼‰ | è§ä¸‹æ–¹æ ¼å¼ç¤ºä¾‹ |
| `releaseDate` | string | âŒ | å‘å¸ƒæ—¥æœŸ | `"2025-12-01"` |
| `isActive` | boolean | âŒ | æ˜¯å¦æ¿€æ´»ï¼ˆé»˜è®¤trueï¼‰ | `true` |

---

## ğŸ“ æ›´æ–°æ—¥å¿—å†…å®¹æ ¼å¼å»ºè®®

### æ ‡å‡†æ ¼å¼æ¨¡æ¿

```markdown
## æ›´æ–°å†…å®¹

æœ¬æ¬¡æ›´æ–°å¸¦æ¥äº†ä»¥ä¸‹æ”¹è¿›ï¼š

### âœ¨ æ–°å¢åŠŸèƒ½
- æ–°å¢åŠŸèƒ½A
- æ–°å¢åŠŸèƒ½B

### ğŸ› é—®é¢˜ä¿®å¤
- ä¿®å¤äº†é—®é¢˜X
- ä¿®å¤äº†é—®é¢˜Y

### âš¡ æ€§èƒ½ä¼˜åŒ–
- ä¼˜åŒ–äº†æ€§èƒ½Z

### ğŸ”„ åŠŸèƒ½æ”¹è¿›
- æ”¹è¿›äº†åŠŸèƒ½M
- æ”¹è¿›äº†åŠŸèƒ½N

### ğŸ“š æ–‡æ¡£æ›´æ–°
- æ›´æ–°äº†æ–‡æ¡£X
```

### å¸¸ç”¨ Emoji

- âœ¨ æ–°å¢åŠŸèƒ½
- ğŸ› é—®é¢˜ä¿®å¤
- âš¡ æ€§èƒ½ä¼˜åŒ–
- ğŸ”„ åŠŸèƒ½æ”¹è¿›
- ğŸ“š æ–‡æ¡£æ›´æ–°
- ğŸ”’ å®‰å…¨æ›´æ–°
- ğŸ¨ UI/UX æ”¹è¿›
- ğŸ—‘ï¸ ç§»é™¤åŠŸèƒ½

---

## ğŸ”„ æ›´æ–°å·²æœ‰ç‰ˆæœ¬æ—¥å¿—

### é€šè¿‡ API

```bash
curl -X PUT http://localhost:8000/api/v1/versions/1.6.0 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "title": "æ›´æ–°åçš„æ ‡é¢˜",
    "content": "æ›´æ–°åçš„å†…å®¹",
    "releaseDate": "2025-12-02",
    "isActive": true
  }'
```

### é€šè¿‡ SQL

```sql
UPDATE version_changelogs 
SET 
  title = 'æ›´æ–°åçš„æ ‡é¢˜',
  content = 'æ›´æ–°åçš„å†…å®¹',
  release_date = '2025-12-02',
  is_active = 1,
  updated_at = UNIX_TIMESTAMP() * 1000
WHERE version = '1.6.0';
```

---

## âœ… éªŒè¯æ›´æ–°æ—¥å¿—

### 1. æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬

```bash
curl http://localhost:8000/api/v1/versions
```

### 2. æŸ¥çœ‹ç‰¹å®šç‰ˆæœ¬

```bash
curl http://localhost:8000/api/v1/versions/1.6.0
```

### 3. æŸ¥çœ‹æ•°æ®åº“

```sql
SELECT version, title, release_date, is_active 
FROM version_changelogs 
ORDER BY version DESC;
```

---

## ğŸ’¡ æ³¨æ„äº‹é¡¹

1. **ç‰ˆæœ¬å·æ ¼å¼**ï¼šå»ºè®®ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ï¼ˆå¦‚ `1.6.0`ã€`1.6.1`ï¼‰
2. **ç‰ˆæœ¬å·å”¯ä¸€æ€§**ï¼šæ¯ä¸ªç‰ˆæœ¬å·åªèƒ½å­˜åœ¨ä¸€æ¡è®°å½•
3. **æ¿€æ´»çŠ¶æ€**ï¼šåªæœ‰ `is_active = 1` çš„ç‰ˆæœ¬æ‰ä¼šæ˜¾ç¤ºç»™ç”¨æˆ·
4. **æœ€æ–°ç‰ˆæœ¬**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ç‰ˆæœ¬å·æœ€å¤§çš„æ¿€æ´»ç‰ˆæœ¬ä½œä¸ºå½“å‰ç‰ˆæœ¬
5. **Markdown æ”¯æŒ**ï¼š`content` å­—æ®µæ”¯æŒ Markdown æ ¼å¼ï¼Œå‰ç«¯ä¼šè‡ªåŠ¨æ¸²æŸ“
6. **æ—¥æœŸæ ¼å¼**ï¼š`releaseDate` å»ºè®®ä½¿ç”¨ `YYYY-MM-DD` æ ¼å¼

---

## ğŸ¯ ç¤ºä¾‹ï¼šåˆ›å»º v1.6.0 æ›´æ–°æ—¥å¿—

### å®Œæ•´ç¤ºä¾‹ï¼ˆAPIæ–¹å¼ï¼‰

```bash
# 1. ç™»å½•è·å– token
TOKEN=$(curl -X POST http://localhost:8000/api/v1/users/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"your_password"}' \
  | jq -r '.data.token')

# 2. åˆ›å»ºæ›´æ–°æ—¥å¿—
curl -X POST http://localhost:8000/api/v1/versions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d @- << 'EOF'
{
  "version": "1.6.0",
  "title": "v1.6.0 ç‰ˆæœ¬æ›´æ–°",
  "content": "## æ›´æ–°å†…å®¹\n\næœ¬æ¬¡æ›´æ–°å¸¦æ¥äº†ä»¥ä¸‹æ”¹è¿›ï¼š\n\n### âœ¨ æ–°å¢åŠŸèƒ½\n- æ–°å¢å¯¹è¯æœç´¢åŠŸèƒ½\n- æ–°å¢æ•°æ®å¯¼å‡ºåŠŸèƒ½\n\n### ğŸ› é—®é¢˜ä¿®å¤\n- ä¿®å¤äº†ç™»å½•çŠ¶æ€ä¸¢å¤±çš„é—®é¢˜\n- ä¿®å¤äº†æ¶ˆæ¯å‘é€å¤±è´¥çš„é—®é¢˜\n\n### âš¡ æ€§èƒ½ä¼˜åŒ–\n- ä¼˜åŒ–äº†é¡µé¢åŠ è½½é€Ÿåº¦\n- ä¼˜åŒ–äº†æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½",
  "releaseDate": "2025-12-01",
  "isActive": true
}
EOF
```

### å®Œæ•´ç¤ºä¾‹ï¼ˆSQLæ–¹å¼ï¼‰

```sql
INSERT INTO version_changelogs 
  (version, title, content, release_date, is_active, created_at, updated_at)
VALUES (
  '1.6.0',
  'v1.6.0 ç‰ˆæœ¬æ›´æ–°',
  '## æ›´æ–°å†…å®¹

æœ¬æ¬¡æ›´æ–°å¸¦æ¥äº†ä»¥ä¸‹æ”¹è¿›ï¼š

### âœ¨ æ–°å¢åŠŸèƒ½
- æ–°å¢å¯¹è¯æœç´¢åŠŸèƒ½
- æ–°å¢æ•°æ®å¯¼å‡ºåŠŸèƒ½

### ğŸ› é—®é¢˜ä¿®å¤
- ä¿®å¤äº†ç™»å½•çŠ¶æ€ä¸¢å¤±çš„é—®é¢˜
- ä¿®å¤äº†æ¶ˆæ¯å‘é€å¤±è´¥çš„é—®é¢˜

### âš¡ æ€§èƒ½ä¼˜åŒ–
- ä¼˜åŒ–äº†é¡µé¢åŠ è½½é€Ÿåº¦
- ä¼˜åŒ–äº†æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½',
  '2025-12-01',
  1,
  UNIX_TIMESTAMP() * 1000,
  UNIX_TIMESTAMP() * 1000
);
```

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- API è·¯ç”±ï¼š`npc-backend/routes/versions.js`
- æ•°æ®è®¿é—®å±‚ï¼š`npc-backend/repositories/VersionRepository.js`
- ç‰ˆæœ¬é…ç½®ï¼š`npc-backend/config/version.js`
- æ•°æ®åº“è¿ç§»ï¼š`npc-backend/migrations/007_create_version_changelogs_table.sql`

