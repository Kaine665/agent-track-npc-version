# 更新日志使用指南（超简单版）

## 📍 使用位置说明

**推荐：在云服务器上使用** ✅

- 更新日志是给生产用户看的，应该直接写入生产数据库
- 本地创建的更新日志只在本地数据库，生产用户看不到

详细说明请查看：[更新日志使用场景说明.md](./更新日志使用场景说明.md)

---

## 🚀 快速开始

### 方法一：使用交互式脚本（推荐，最简单）

```bash
cd npc-backend
npm run changelog:create
```

然后按照提示输入：
1. 用户 ID（你的管理员账号）
2. 密码
3. 版本号（如：1.6.0）
4. 更新标题（如：v1.6.0 版本更新）
5. 发布日期（可选，直接回车使用今天）
6. 更新内容（输入多行，输入 "END" 结束）
7. 是否激活（y/n，默认 y）

**示例：**
```
请输入用户 ID: admin
请输入密码: 123456
版本号（如 1.6.0）: 1.6.0
更新标题（如 v1.6.0 版本更新）: v1.6.0 版本更新
发布日期（如 2025-12-01，可选，直接回车使用今天）: 
请输入更新内容（Markdown 格式）：
提示：输入多行内容，输入 "END" 结束输入

## 🎉 新功能
- 对话搜索功能
- 数据导出功能
END
是否激活（y/n，默认 y）: y
```

### 方法二：使用命令行参数（适合脚本化）

```bash
cd npc-backend
npm run changelog:create:simple "1.6.0" "v1.6.0 版本更新" "## 更新内容\n\n### ✨ 新增功能\n- 功能A" "2025-12-01"
```

### 方法三：直接使用 SQL（最快，但需要数据库权限）

```bash
# 1. 连接到数据库
docker-compose exec mysql mysql -u root -p npc_db

# 或者直接连接
mysql -u root -p npc_db
```

```sql
INSERT INTO version_changelogs 
  (version, title, content, release_date, is_active, created_at, updated_at)
VALUES (
  '1.6.0',                                    -- 版本号
  'v1.6.0 版本更新',                          -- 标题
  '## 🎉 新功能
- 对话搜索功能
- 数据导出功能

## 🐛 问题修复
- 修复了登录问题',                            -- 内容（Markdown格式）
  '2025-12-01',                               -- 发布日期
  1,                                          -- 是否激活（1=激活，0=禁用）
  UNIX_TIMESTAMP() * 1000,                    -- 创建时间戳
  UNIX_TIMESTAMP() * 1000                     -- 更新时间戳
);
```

---

## 📝 更新日志内容模板

### 简单模板（复制使用）

```markdown
## 🎉 新功能
- **功能名称**：一句话说明用户价值

## 🔧 优化改进
- 改进点 + 用户能感受到的好处

## 🐛 问题修复
- 修复了 XXX 问题，现在更稳定了
```

### 完整模板

```markdown
## 🎉 新功能

### 对话搜索
快速找到历史对话，再也不用翻页了！支持关键词搜索，秒速定位。

### 一键导出
支持导出为 Word、PDF、Markdown 等多种格式，方便保存和分享。

## 🔧 优化改进

- **登录速度提升 50%**：打开应用更快了，体验更流畅
- **对话界面优化**：打字不再卡顿，消息发送更顺畅

## 🐛 问题修复

- 修复了偶尔无法发送消息的问题
- 修复了夜间模式下的显示问题

## ⚡ 性能优化

- 优化了页面加载速度
- 优化了数据库查询性能
```

---

## ✅ 验证更新日志

### 查看所有版本

```bash
curl http://localhost:8000/api/v1/versions
```

### 查看特定版本

```bash
curl http://localhost:8000/api/v1/versions/1.6.0
```

### 查看数据库

```sql
SELECT version, title, release_date, is_active 
FROM version_changelogs 
ORDER BY version DESC;
```

---

## 🔄 更新已有版本日志

### 使用 SQL

```sql
UPDATE version_changelogs 
SET 
  title = '更新后的标题',
  content = '更新后的内容',
  release_date = '2025-12-02',
  is_active = 1,
  updated_at = UNIX_TIMESTAMP() * 1000
WHERE version = '1.6.0';
```

### 禁用某个版本（不显示给用户）

```sql
UPDATE version_changelogs 
SET is_active = 0 
WHERE version = '1.6.0';
```

---

## 💡 常见问题

### Q: 用户什么时候能看到更新日志？
A: 用户登录时会自动检查，如果有新版本且用户未读，会弹出更新提示。

### Q: 如何让用户看不到某个版本？
A: 将该版本的 `is_active` 设置为 `0`。

### Q: 版本号格式有要求吗？
A: 建议使用语义化版本号（如 `1.6.0`、`1.6.1`），但系统不强制。

### Q: 可以创建多个版本吗？
A: 可以，但版本号必须唯一。系统会自动选择版本号最大的激活版本作为当前版本。

### Q: 更新日志支持 Markdown 吗？
A: 支持！前端会自动渲染 Markdown 格式。

---

## 🎯 完整示例

### 创建 v1.6.0 更新日志

**步骤 1：运行脚本**
```bash
cd npc-backend
npm run changelog:create
```

**步骤 2：按提示输入**
```
请输入用户 ID: admin
请输入密码: 123456
版本号（如 1.6.0）: 1.6.0
更新标题（如 v1.6.0 版本更新）: v1.6.0 版本更新
发布日期（如 2025-12-01，可选，直接回车使用今天）: 2025-12-01
请输入更新内容（Markdown 格式）：
提示：输入多行内容，输入 "END" 结束输入

## 🎉 新功能
- **对话搜索**：快速找到历史对话，再也不用翻页了！
- **一键导出**：支持导出为 Word、PDF，方便保存和分享

## 🐛 问题修复
- 修复了登录状态丢失的问题
- 修复了消息发送失败的问题

## ⚡ 性能优化
- 优化了页面加载速度
END
是否激活（y/n，默认 y）: y
```

**步骤 3：完成！**
```
✅ 更新日志创建成功！

版本号: 1.6.0
标题: v1.6.0 版本更新
发布日期: 2025-12-01
激活状态: ✅ 已激活

💡 提示：用户登录时会自动看到此更新日志
```

---

## 📚 相关文件

- 交互式脚本：`npc-backend/scripts/create-changelog.js`
- 命令行脚本：`npc-backend/scripts/create-changelog-simple.js`
- 内容模板：`npc-backend/scripts/create-changelog-template.md`
- API 路由：`npc-backend/routes/versions.js`
- 数据库表：`version_changelogs`

