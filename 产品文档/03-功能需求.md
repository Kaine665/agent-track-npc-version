# 03-功能需求

**文档版本**：v1.1  
**最后更新**：2025-11-20  
**相关文档**：[产品概述](./01-产品概述.md) | [API 设计](./04-API设计.md) | [数据模型](./05-数据模型.md)

---

## 1. 功能需求总览

### 1.1 功能模块划分

| 模块     | 功能编号 | 功能名称     | 优先级 | 状态       |
| -------- | -------- | ------------ | ------ | ---------- |
| NPC 管理 | F1       | 创建 NPC     | P0     | ✅ 已完成  |
| NPC 管理 | F2       | NPC 列表展示 | P0     | ✅ 已完成  |
| NPC 管理 | F3       | 编辑 NPC     | P2     | V2（待定） |
| NPC 管理 | F4       | 删除 NPC     | P2     | V2（待定） |
| 对话系统 | F5       | 发送消息     | P0     | 🚧 进行中  |
| 对话系统 | F6       | 获取对话历史 | P0     | 待开发     |
| 对话系统 | F7       | 实时消息推送 | P1     | 待开发     |
| 事件系统 | F8       | 事件记录     | P0     | ✅ 已完成  |
| 事件系统 | F9       | 事件查询     | P0     | ✅ 已完成  |

---

## 2. NPC 管理模块

### 2.1 F1：创建 NPC

#### 2.1.1 功能描述

用户可以通过表单创建新的 AI NPC，配置 NPC 的基本信息、人设和使用的模型。

#### 2.1.2 用户故事

**作为** 用户  
**我希望** 能够创建自定义的 AI NPC  
**以便于** 与不同人设的 AI 进行对话，满足不同场景的需求

#### 2.1.3 功能流程

```
用户进入创建页面
  ↓
填写 NPC 信息表单
  ├─ 名称（必填）
  ├─ 类型（必填：通用/特定）
  ├─ 人设描述（必填：system prompt）
  ├─ 使用模型（必填：如 GPT-4.1）
  └─ 头像（可选：URL 或上传）
  ↓
点击"创建"按钮
  ↓
前端验证表单
  ├─ 名称：1-50 字符，不能为空
  ├─ 类型：必须选择
  ├─ 人设：10-5000 字符，不能为空
  ├─ 模型：必须选择支持的模型
  └─ 头像：URL 格式验证（如提供）
  ↓
发送创建请求到后端
  ↓
后端创建 Agent 记录
  ├─ 生成唯一 agentId
  ├─ 保存到数据库
  └─ 返回 agentId
  ↓
前端接收成功响应
  ↓
跳转到 NPC 列表页面（显示新创建的 NPC）
```

#### 2.1.4 输入输出规范

**输入字段**：

| 字段名       | 类型   | 必填 | 长度限制     | 说明                           | 示例                               |
| ------------ | ------ | ---- | ------------ | ------------------------------ | ---------------------------------- |
| name         | string | 是   | 1-50 字符    | NPC 名称                       | "学习教练"                         |
| type         | enum   | 是   | -            | NPC 类型                       | "general" 或 "special"             |
| systemPrompt | string | 是   | 10-5000 字符 | NPC 人设描述                   | "你是一位专业的学习教练..."        |
| model        | string | 是   | -            | 使用的 LLM 模型名称            | "gpt-4o" 或 "deepseek-chat"        |
| provider     | string | 否   | -            | 模型提供商（自定义模型时必填） | "openai"、"deepseek"、"openrouter" |
| avatarUrl    | string | 否   | URL 格式     | 头像 URL                       | "https://..."                      |

**模型配置说明**：

- **预设模型模式**：如果配置了预设模型（MODELS 环境变量），只需提供 `model` 字段，系统会自动识别提供商
- **自定义模型模式**：如果没有预设模型，必须同时提供 `model` 和 `provider` 字段
- **支持的提供商**：OpenAI、DeepSeek、OpenRouter

**输出结果**：

- **成功**：返回创建的 Agent 对象（包含 agentId）
- **失败**：返回错误信息（字段验证失败、系统错误等）

#### 2.1.5 业务规则

1. **名称唯一性**：同一用户创建的 NPC 名称不能重复（不区分大小写）
2. **模型支持**：
   - 如果配置了预设模型，只能选择预设模型列表中的模型
   - 如果没有预设模型，可以选择任意模型，但必须指定提供商且提供商必须启用
3. **提供商配置**：
   - 通过环境变量 `ENABLE_OPENAI`、`ENABLE_DEEPSEEK`、`ENABLE_OPENROUTER` 控制提供商启用
   - 通过环境变量 `MODELS` 配置预设模型（格式：`model:provider`）
4. **人设长度**：systemPrompt 必须足够详细（至少 10 字符），但不超过 5000 字符
5. **类型说明**：
   - `general`：通用助手，适用于多种场景
   - `special`：特定功能 NPC，专注于某个领域（如学习、心理等）

#### 2.1.6 边界条件

- **名称重复**：如果用户输入的名称已存在，提示"该名称已存在，请使用其他名称"
- **模型不可用**：如果选择的模型当前不可用，提示"该模型暂时不可用，请选择其他模型"
- **网络错误**：创建过程中网络中断，提示"网络错误，请重试"
- **系统限制**：单个用户最多创建 50 个 NPC（V1 暂不限制，但需记录）

#### 2.1.7 错误处理

| 错误场景 | 错误码           | 错误信息                       | 处理方式               |
| -------- | ---------------- | ------------------------------ | ---------------------- |
| 名称为空 | VALIDATION_ERROR | "NPC 名称不能为空"             | 前端提示，阻止提交     |
| 名称过长 | VALIDATION_ERROR | "NPC 名称不能超过 50 字符"     | 前端提示，阻止提交     |
| 名称重复 | DUPLICATE_NAME   | "该名称已存在，请使用其他名称" | 前端提示，允许修改     |
| 人设为空 | VALIDATION_ERROR | "人设描述不能为空"             | 前端提示，阻止提交     |
| 人设过短 | VALIDATION_ERROR | "人设描述至少需要 10 字符"     | 前端提示，阻止提交     |
| 模型无效 | INVALID_MODEL    | "无效的模型选择"               | 前端提示，阻止提交     |
| 系统错误 | SYSTEM_ERROR     | "创建失败，请稍后重试"         | 记录日志，提示用户重试 |

#### 2.1.8 验收标准

- [x] 用户能够成功创建 NPC，所有必填字段验证通过 ✅
- [x] 创建成功后，NPC 出现在列表中 ✅
- [x] 名称重复时，系统正确提示错误 ✅
- [x] 所有字段验证规则正确执行 ✅
- [x] 创建失败时，错误信息清晰明确 ✅
- [x] 创建过程有加载状态提示 ✅

**实现状态**：已完成（2025-11-20）  
**实现说明**：

- 已实现 POST /api/v1/agents 接口
- 支持模型配置（预设模型或自定义模型）
- 支持多 LLM 提供商（OpenAI、DeepSeek、OpenRouter）
- 使用内存存储（开发阶段），未来可迁移到数据库

---

### 2.2 F2：NPC 列表展示

#### 2.2.1 功能描述

展示用户创建的所有 NPC，支持点击进入对话页面。

#### 2.2.2 用户故事

**作为** 用户  
**我希望** 能够看到我创建的所有 NPC  
**以便于** 快速选择想要对话的 NPC

#### 2.2.3 功能流程

```
用户进入 NPC 列表页面
  ↓
前端请求用户的所有 NPC 列表
  ↓
后端查询数据库，返回 NPC 列表
  ↓
前端渲染 NPC 卡片列表
  ├─ 每个卡片显示：头像、名称、类型、创建时间
  └─ 卡片可点击，进入对话页面
  ↓
用户点击某个 NPC 卡片
  ↓
跳转到该 NPC 的对话页面
```

#### 2.2.4 输入输出规范

**输入**：

- 无（通过 userId 自动获取）

**输出**：

- NPC 列表数组，每个元素包含：
  - `id`: Agent ID
  - `name`: NPC 名称
  - `type`: NPC 类型
  - `avatarUrl`: 头像 URL（可选）
  - `createdAt`: 创建时间戳
  - `lastMessageAt`: 最后对话时间（可选）

#### 2.2.5 业务规则

1. **列表排序**：按最后对话时间倒序排列（最近对话的在前），如果没有对话记录，按创建时间倒序
2. **空状态**：如果用户没有创建任何 NPC，显示"创建你的第一个 NPC"提示和创建按钮
3. **分页**：如果 NPC 数量较多（>20），支持分页或滚动加载（V1 暂不实现分页）

#### 2.2.6 UI 设计要求

- **卡片布局**：网格布局，每行显示 2-4 个卡片（响应式）
- **卡片内容**：
  - 头像（圆形，默认头像如果未设置）
  - 名称（粗体，最大 2 行，超出省略）
  - 类型标签（"通用"或"特定"）
  - 最后对话时间（相对时间，如"2 小时前"）
- **交互效果**：卡片 hover 时有阴影效果，点击有反馈

#### 2.2.7 边界条件

- **空列表**：显示空状态提示和创建按钮
- **加载中**：显示加载动画
- **加载失败**：显示错误提示和重试按钮

#### 2.2.8 验收标准

- [x] 正确显示用户创建的所有 NPC ✅
- [ ] 列表按最后对话时间倒序排列（V1 暂按创建时间排序）
- [ ] 点击卡片能够跳转到对话页面（前端待实现）
- [ ] 空状态正确显示（前端待实现）
- [ ] 加载状态和错误状态正确处理（前端待实现）

**实现状态**：后端已完成（2025-11-20）  
**实现说明**：

- 已实现 GET /api/v1/agents 接口
- 支持按 createdBy 查询用户创建的 NPC
- 返回完整的 Agent 信息（id、name、type、model、systemPrompt、avatarUrl、createdAt、updatedAt）
- 使用内存存储（开发阶段），未来可迁移到数据库

---

## 3. 对话系统模块

### 3.1 F5：发送消息

#### 3.1.1 功能描述

用户向选中的 NPC 发送消息，系统调用 LLM API 生成回复，并保存对话记录。

#### 3.1.2 用户故事

**作为** 用户  
**我希望** 能够向 NPC 发送消息并收到回复  
**以便于** 与 NPC 进行对话交流

#### 3.1.3 功能流程

```
用户在输入框输入消息
  ↓
点击发送按钮（或按 Enter）
  ↓
前端验证消息
  ├─ 消息不能为空
  ├─ 消息长度不超过 5000 字符
  └─ 发送按钮禁用，显示加载状态
  ↓
发送 POST /api/message 请求
  ├─ userId: 用户 ID
  ├─ agentId: NPC ID
  └─ text: 消息内容
  ↓
后端处理流程：
  ├─ 1. 验证参数（userId, agentId, text）
  ├─ 2. 写入 Event（用户发言）
  │   └─ from: 'user', fromId: userId, to: 'agent', toId: agentId
  ├─ 3. 读取 Agent 配置（获取 systemPrompt 和 model）
  ├─ 4. 获取最近 N 条历史事件（上下文，默认 20 条）
  ├─ 5. 构建 LLM Prompt
  │   ├─ system: Agent 的 systemPrompt
  │   └─ messages: 历史事件转换为对话格式
  ├─ 6. 调用 LLM API（使用 Agent 配置的 model）
  ├─ 7. 写入 Event（NPC 回复）
  │   └─ from: 'agent', fromId: agentId, to: 'user', toId: userId
  └─ 8. 返回 NPC 回复内容
  ↓
前端接收响应
  ├─ 成功：显示 NPC 回复消息
  └─ 失败：显示错误提示
  ↓
更新对话历史显示
```

#### 3.1.4 输入输出规范

**请求格式**：

```json
{
  "userId": "user_123",
  "agentId": "agent_456",
  "text": "今天有什么学习建议？"
}
```

**响应格式**：

```json
{
  "success": true,
  "data": {
    "eventId": "event_789",
    "content": "我们先从制定学习计划开始吧...",
    "timestamp": 1703001234567
  }
}
```

**错误响应**：

```json
{
  "success": false,
  "error": {
    "code": "LLM_API_ERROR",
    "message": "LLM API 调用失败，请稍后重试"
  }
}
```

#### 3.1.5 业务规则

1. **消息长度限制**：单条消息不超过 5000 字符
2. **上下文窗口**：默认获取最近 20 条事件作为上下文（可配置）
3. **Token 限制**：如果上下文超过模型的最大 token 限制，截取最近的 N 条事件
4. **重试机制**：LLM API 调用失败时，自动重试 2 次（间隔 1 秒）
5. **超时处理**：LLM API 调用超时时间设置为 30 秒（可配置，默认 30 秒）
6. **并发控制**：同一用户同一 NPC 的对话请求串行处理（防止消息顺序混乱）
7. **LLM 提供商支持**：支持 OpenAI、DeepSeek、OpenRouter 三个提供商
8. **模型配置**：支持预设模型和自定义模型两种配置模式

#### 3.1.6 Prompt 构建规则

**System Prompt**：

- 直接使用 Agent 的 `systemPrompt` 字段

**Messages 构建**：

- 将历史事件转换为对话格式
- 用户发言：`{ role: 'user', content: event.content }`
- NPC 回复：`{ role: 'assistant', content: event.content }`
- 按时间顺序排列

**示例**：

```
System: "你是一位专业的学习教练..."
Messages: [
  { role: 'user', content: '你好' },
  { role: 'assistant', content: '你好！我是你的学习教练...' },
  { role: 'user', content: '今天有什么学习建议？' }
]
```

#### 3.1.7 边界条件

- **消息为空**：前端阻止发送，提示"消息不能为空"
- **消息过长**：前端阻止发送，提示"消息过长，请缩短"
- **Agent 不存在**：返回错误"NPC 不存在"
- **LLM API 失败**：重试后仍失败，返回错误信息
- **LLM API 超时**：返回超时错误，提示用户重试
- **上下文过长**：自动截取最近的 N 条事件

#### 3.1.8 错误处理

| 错误场景     | 错误码           | 错误信息                      | 处理方式           |
| ------------ | ---------------- | ----------------------------- | ------------------ |
| 消息为空     | VALIDATION_ERROR | "消息不能为空"                | 前端提示，阻止发送 |
| 消息过长     | VALIDATION_ERROR | "消息过长，请缩短"            | 前端提示，阻止发送 |
| Agent 不存在 | AGENT_NOT_FOUND  | "NPC 不存在"                  | 返回错误，前端提示 |
| LLM API 失败 | LLM_API_ERROR    | "AI 回复生成失败，请稍后重试" | 记录日志，返回错误 |
| LLM API 超时 | LLM_API_TIMEOUT  | "请求超时，请重试"            | 记录日志，返回错误 |
| 系统错误     | SYSTEM_ERROR     | "系统错误，请稍后重试"        | 记录日志，返回错误 |

#### 3.1.9 性能要求

- **响应时间**：P95 响应时间 < 3 秒（取决于 LLM API 速度）
- **并发支持**：支持至少 100 并发请求
- **重试延迟**：重试间隔 1 秒，最多重试 2 次

#### 3.1.10 验收标准

- [ ] 用户能够成功发送消息并收到 NPC 回复（后端 LLMService 已完成，MessageService 和路由待实现）
- [ ] 消息和回复都正确保存到事件记录中（EventService 已完成）
- [ ] NPC 回复基于历史上下文生成（LLMService 支持，MessageService 待实现）
- [ ] 消息验证规则正确执行（待实现）
- [x] LLM API 失败时正确处理和提示 ✅（LLMService 已实现重试和错误处理）
- [ ] 发送过程中有加载状态提示（前端待实现）
- [ ] 响应时间在可接受范围内（待测试）

**实现状态**：部分完成（2025-11-20）  
**已完成部分**：

- ✅ LLMService：已实现多提供商 LLM API 调用（OpenAI、DeepSeek、OpenRouter）
- ✅ EventService：已实现事件创建和查询
- ✅ SessionService：已实现会话管理
- ✅ 模型配置管理：支持环境变量配置预设模型和自定义模型
- ✅ 错误处理和重试机制：已实现

**待实现部分**：

- ⏳ MessageService：消息发送流程编排（8 个步骤）
- ⏳ 消息路由：POST /api/v1/messages 接口
- ⏳ 前端实现：消息发送 UI 和状态提示

---

### 3.2 F6：获取对话历史

#### 3.2.1 功能描述

获取用户与指定 NPC 的完整对话历史记录。

#### 3.2.2 用户故事

**作为** 用户  
**我希望** 能够查看与 NPC 的历史对话记录  
**以便于** 回顾之前的对话内容

#### 3.2.3 功能流程

```
用户进入对话页面
  ↓
前端请求对话历史
  GET /api/history?agentId=xxx&userId=yyy
  ↓
后端查询事件记录
  ├─ 查询条件：agentId + userId
  ├─ 排序：按 timestamp 升序
  └─ 返回所有事件
  ↓
前端渲染对话历史
  ├─ 用户消息：左侧显示
  ├─ NPC 消息：右侧显示
  └─ 按时间顺序排列
```

#### 3.2.4 输入输出规范

**请求参数**：

| 参数名  | 类型   | 必填 | 说明                            |
| ------- | ------ | ---- | ------------------------------- |
| agentId | string | 是   | NPC ID                          |
| userId  | string | 是   | 用户 ID                         |
| limit   | number | 否   | 返回数量限制（默认不限制）      |
| offset  | number | 否   | 偏移量（用于分页，V1 暂不支持） |

**响应格式**：

```json
{
  "success": true,
  "data": {
    "events": [
      {
        "id": "event_1",
        "from": "user",
        "fromId": "user_123",
        "to": "agent",
        "toId": "agent_456",
        "content": "你好",
        "timestamp": 1703001000000
      },
      {
        "id": "event_2",
        "from": "agent",
        "fromId": "agent_456",
        "to": "user",
        "toId": "user_123",
        "content": "你好！我是你的学习教练...",
        "timestamp": 1703001001000
      }
    ],
    "total": 2
  }
}
```

#### 3.2.5 业务规则

1. **数据隔离**：只返回指定 userId 和 agentId 的事件记录
2. **时间排序**：按 timestamp 升序排列（最早的在前面）
3. **完整历史**：V1 返回所有历史记录（不限制数量，但需考虑性能）
4. **空历史**：如果没有历史记录，返回空数组

#### 3.2.6 边界条件

- **无历史记录**：返回空数组，前端显示"开始你的第一次对话吧"
- **Agent 不存在**：返回错误"NPC 不存在"
- **参数缺失**：返回参数错误

#### 3.2.7 性能要求

- **查询性能**：在 1000 条记录内，查询时间 < 100ms
- **数据量限制**：V1 暂不限制，但需考虑未来分页

#### 3.2.8 验收标准

- [ ] 正确返回用户与 NPC 的所有对话历史
- [ ] 历史记录按时间顺序正确排列
- [ ] 空历史时正确显示空状态
- [ ] 查询性能满足要求

---

## 4. 事件系统模块

### 4.1 F8：事件记录

#### 4.1.1 功能描述

统一记录所有对话事件（用户发言、NPC 回复），为对话历史和上下文提供数据基础。

#### 4.1.2 功能说明

事件记录是系统的核心数据层，所有对话都通过事件记录。事件记录在以下场景自动创建：

1. **用户发送消息时**：自动创建用户发言事件
2. **NPC 生成回复时**：自动创建 NPC 回复事件

#### 4.1.3 事件结构

```typescript
interface Event {
  id: string; // 事件唯一 ID（自动生成）
  sessionId: string; // 会话 ID（独立生成，不依赖参与者）
  userId: string; // 用户 ID
  agentId: string; // Agent ID
  fromType: "user" | "agent"; // 发送者类型
  fromId: string; // 发送者 ID
  toType: "user" | "agent"; // 接收者类型
  toId: string; // 接收者 ID
  content: string; // 消息内容
  timestamp: number; // 时间戳（毫秒，服务器时间）
}
```

**设计说明**：

- `sessionId` 独立生成，支持未来多参与者会话扩展
- `participants` 列表存储在 Session 中，支持灵活查询
- Session 和 Event 已分离为独立的 Repository 和 Service

#### 4.1.4 业务规则

1. **自动创建**：事件在对话流程中自动创建，不需要单独调用 API
2. **唯一性**：每个事件都有唯一的 ID（自动生成）
3. **Session ID**：sessionId 独立生成，通过 participants 列表关联用户和 Agent
4. **时间戳**：使用服务器时间戳，确保时间准确性
5. **内容存储**：原始内容完整存储，不做修改
6. **会话管理**：同一参与者组合只有一个会话（单会话模式）
7. **活动时间**：创建事件时自动更新会话的 lastActiveAt

#### 4.1.5 数据持久化

- **存储方式**：开发阶段使用内存存储（Map），未来迁移到数据库
- **索引设计**：
  - 中心化存储：`eventsMap`（Map<eventId, Event>）
  - 会话索引：`eventsBySession`（{ [sessionId]: eventId[] }）
  - 未来扩展：支持主题筛选、时间范围查询等
- **数据保留**：事件记录永久保存，不自动删除
- **架构设计**：Session 和 Event 已分离为独立的 Repository 和 Service

#### 4.1.6 验收标准

- [x] 用户发言时自动创建事件记录 ✅（EventService.createEvent 已实现）
- [x] NPC 回复时自动创建事件记录 ✅（EventService.createEvent 已实现）
- [x] 事件记录包含所有必需字段 ✅（EventRepository 已实现）
- [x] 事件记录正确保存到存储 ✅（内存存储已实现，数据库待迁移）

**实现状态**：已完成（2025-11-20）  
**实现说明**：

- ✅ EventRepository：已实现事件的内存存储和索引
- ✅ EventService：已实现事件创建和查询的业务逻辑
- ✅ SessionRepository：已实现会话的内存存储和索引
- ✅ SessionService：已实现会话管理的业务逻辑
- ✅ 架构分离：Session 和 Event 已分离为独立的 Repository 和 Service

---

### 4.2 F9：事件查询

#### 4.2.1 功能描述

查询指定会话的事件记录，支持按时间范围、事件类型等条件查询。

#### 4.2.2 查询场景

1. **获取对话历史**：查询用户与 NPC 的所有事件
2. **构建上下文**：查询最近 N 条事件用于 LLM 上下文
3. **统计分析**：查询事件数量、时间分布等（V2 功能）

#### 4.2.3 查询接口

**基础查询**：

- 按 sessionId 查询
- 按时间范围查询
- 按事件类型查询（from 字段）

**排序和分页**：

- 按 timestamp 排序（升序/降序）
- 支持 limit 和 offset（V1 暂不支持分页）

#### 4.2.4 性能优化

- **索引优化**：在 sessionId、timestamp 上建立索引
- **查询缓存**：对最近查询的会话历史进行缓存（V2 考虑）
- **批量查询**：支持批量查询多个会话的事件（V2 功能）

#### 4.2.5 验收标准

- [x] 能够正确查询指定会话的事件记录 ✅（EventRepository.getEventsBySession 已实现）
- [x] 查询结果按时间正确排序 ✅（按 timestamp 升序排序）
- [x] 查询性能满足要求 ✅（内存存储，性能良好）

**实现状态**：已完成（2025-11-20）  
**实现说明**：

- ✅ EventRepository.getEventsBySession：已实现按会话 ID 查询事件
- ✅ EventRepository.getRecentEvents：已实现获取最近 N 条事件（用于上下文构建）
- ✅ EventRepository.getEventsBySessionWithOptions：已实现（未来功能，支持分页和筛选）
- ✅ EventRepository.filterEventsByTopic：已实现（未来功能，支持主题筛选）
- ✅ 索引优化：使用 eventsBySession 索引，查询性能良好

---

## 5. 功能依赖关系

```
F1 (创建 NPC)
  └─> F2 (NPC 列表展示)

F2 (NPC 列表展示)
  └─> F5 (发送消息)
  └─> F6 (获取对话历史)

F5 (发送消息)
  └─> F8 (事件记录)
  └─> F6 (获取对话历史) [用于构建上下文]

F6 (获取对话历史)
  └─> F9 (事件查询)
```

---

## 6. 功能优先级总结

### P0（必须实现）

- F1：创建 NPC
- F2：NPC 列表展示
- F5：发送消息
- F6：获取对话历史
- F8：事件记录
- F9：事件查询

### P1（重要但非必须）

- F7：实时消息推送（WebSocket）

### P2（V2 版本）

- F3：编辑 NPC
- F4：删除 NPC

---

## 7. 相关文档

- [API 设计](./04-API设计.md) - API 接口详细设计
- [数据模型](./05-数据模型.md) - 数据结构设计
- [系统架构](./06-系统架构.md) - 系统架构设计（待生成）

---

**文档维护**：功能需求变更时，需同步更新本文档和相关 API 文档。

---

## 8. 实现进度更新日志

| 日期       | 更新内容                                                              |
| ---------- | --------------------------------------------------------------------- |
| 2024-12-19 | 创建功能需求文档                                                      |
| 2025-11-20 | 更新功能状态：F1、F2、F8、F9 已完成，F5 部分完成                      |
| 2025-11-20 | 更新 F1、F2、F8、F9 的实现说明和验收标准                              |
| 2025-11-20 | 更新 F5 的实现说明：LLMService 已完成，MessageService 和路由待实现    |
| 2025-11-20 | 更新事件结构：Session 和 Event 分离，支持多参与者扩展                 |
| 2025-11-20 | 更新 LLM 支持：多提供商（OpenAI、DeepSeek、OpenRouter）和模型配置说明 |
