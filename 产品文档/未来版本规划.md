# 未来版本规划

**文档版本**：v1.0  
**最后更新**：2025-11-22  
**相关文档**：[V1 产品文档](./v1/README.md)

---

## 说明

本文档描述的是**潜在的功能演进路线图**，而非严格的版本划分。功能之间可能存在依赖关系，某些功能是其他功能的前置条件。路线图可能产生多个分支，根据实际需求、优先级和资源情况灵活选择开发路径。

**核心原则**：
- 功能是**连续谱**，而非离散版本
- 功能之间存在**依赖关系**和**前置条件**
- 路线图可能产生**多个分支**，可以并行开发
- 根据实际需求**灵活选择**开发路径

当前已完成的基础功能请参考 [V1 产品文档](./v1/README.md)。  
**V1.5 版本规划**请参考 [V1.5 版本规划](./v1.5/README.md)。

---

## 1. 功能路线图总览

### 1.1 潜在功能路线图

本文档描述的是一个**连续的功能演进谱系**，而非严格的版本划分。功能之间可能存在依赖关系，某些功能是其他功能的前置条件。路线图可能产生多个分支，根据实际需求和优先级灵活选择开发路径。

```
【已实现基础】✅
  ├─ NPC 创建、对话、历史记录
  ├─ 事件记录系统
  ├─ 基础登录/注册
  └─ API 适配层设计

【安全与认证分支】→ 前置条件：基础登录/注册
  ├─ JWT Token 认证 ✅ V1.5
  │   └─ 依赖：用户认证增强
  ├─ 密码加密（bcrypt）✅ V1.5
  │   └─ 依赖：用户认证增强
  ├─ Token 刷新机制（可选）
  │   └─ 依赖：JWT Token 认证
  └─ API 限流和安全增强 ✅ V1.5（简单版）
      └─ 依赖：JWT Token 认证

【数据管理分支】→ 前置条件：基础功能
  ├─ NPC 编辑和删除 ✅ V1.5
  │   └─ 依赖：基础 NPC 创建
  ├─ 对话搜索功能 ✅ V1.5（不做筛选）
  │   └─ 依赖：对话历史记录
  ├─ 对话筛选功能（未来）
  │   └─ 依赖：对话搜索功能
  └─ 数据导入导出功能 ✅ V1.5
      └─ 依赖：对话历史记录、NPC 数据

【记忆系统分支】→ 前置条件：对话系统
  ├─ 短期记忆系统
  │   └─ 依赖：对话历史记录、事件记录系统
  ├─ 中期记忆系统
  │   └─ 依赖：短期记忆系统、事件记录系统
  └─ 长期记忆系统
      └─ 依赖：中期记忆系统、关系网络

【多 NPC 世界分支】→ 前置条件：单个 NPC 系统、记忆系统
  ├─ 多 NPC 世界场景
  │   └─ 依赖：NPC 创建、场景管理
  ├─ NPC 互相对话
  │   └─ 依赖：多 NPC 世界场景、短期记忆系统、事件总线
  └─ NPC 关系网络
      └─ 依赖：NPC 互相对话、长期记忆系统

【工具与扩展分支】→ 前置条件：对话系统、认证系统
  ├─ 工具调用能力
  │   └─ 依赖：LLM Function Calling、权限系统
  └─ 事件总线架构
      └─ 依赖：事件记录系统、消息队列

【数据统计分支】→ 前置条件：基础功能、数据管理
  ├─ 基础数据统计（未来）
  │   └─ 依赖：对话历史记录、NPC 数据
  └─ 高级数据分析（未来）
      └─ 依赖：基础数据统计、数据导出功能

【用户反馈分支】→ 前置条件：基础功能
  └─ 用户反馈功能 ✅ V1.5

【运维支持分支】→ 前置条件：基础功能
  ├─ 错误日志和监控 ✅ V1.5（简单版）
  │   └─ 依赖：基础功能
  └─ 数据备份机制 ✅ V1.5（简单版）
      └─ 依赖：数据库已建立

【基础设施分支】→ 可独立或并行开发
  ├─ Redis 缓存
  ├─ 消息队列（Redis Streams）
  ├─ 监控和告警系统
  └─ 数据备份机制
```

### 1.2 功能依赖关系说明

**核心依赖链**：
- `基础功能` → `安全与认证` → `数据管理` → `记忆系统` → `多 NPC 世界`
- `基础功能` → `工具与扩展`（可并行）
- `基础功能` → `数据统计`（可并行）

**可选分支**：
- 某些功能可以独立开发，不依赖其他功能
- 某些功能可以并行开发，互不干扰
- 某些功能是其他功能的增强，可以后续添加

**前置条件标注**：
- 每个功能分支都标注了前置条件
- 功能内部标注了依赖关系
- 开发时需确保前置条件已满足

### 1.3 功能开发建议

**并行开发路径**：
- `安全与认证` + `数据管理` + `数据统计` 可以并行开发（互不依赖）
- `工具调用能力` 可以独立开发（不阻塞其他功能）
- `基础设施分支`（Redis、消息队列、监控）可以提前准备

**顺序开发路径**：
- `短期记忆系统` → `中期记忆系统` → `长期记忆系统`（强依赖链）
- `多 NPC 世界场景` → `NPC 互相对话`（强依赖链）
- `事件记录系统` → `事件总线架构`（增强关系）

**灵活选择原则**：
- 根据用户反馈和业务需求选择优先级
- 某些功能可以简化实现，后续再增强
- 某些功能可以分阶段实现，先实现核心部分

---

## 2. 安全与认证功能规划

### 2.1 功能目标

增强用户认证安全性，完善权限验证机制，提升系统安全性。

**前置条件**：基础登录/注册功能已实现

**V1.5 版本状态**：✅ 已规划并实现

### 2.2 功能列表

#### 2.2.1 用户认证增强 ✅ V1.5

**功能描述**：
- 实现 JWT Token 进行用户认证
- 密码加密（bcrypt）
- Token 刷新机制（可选）
- 用户权限验证和数据隔离增强

**前置条件**：
- 基础登录/注册功能

**依赖关系**：
- 后续功能（API 限流、数据统计）依赖此功能

**技术实现**：
- JWT Token 生成和验证
- 密码哈希存储（bcrypt）
- Token 刷新机制（可选）
- 中间件实现 Token 验证

**实现方案**：详见 [V1.5 版本规划 - 密码功能](./v1.5/01-密码功能实现方案.md) 和 [V1.5 版本规划 - JWT认证](./v1.5/02-JWT认证实现方案.md)

**优先级**：P0

---

#### 2.2.2 基础数据统计

**功能描述**：
- 用户数据统计（NPC 数量、对话数量等）
- NPC 使用统计（对话次数、最后使用时间等）
- 简单的数据可视化（图表）

**前置条件**：
- 基础功能（NPC 创建、对话历史记录）
- 用户认证增强（可选，用于用户级别的统计）

**依赖关系**：
- 可独立开发，不阻塞其他功能
- 后续高级数据分析功能依赖此功能

**技术实现**：
- 统计数据表设计
- 统计 API 实现
- 前端图表组件（如 Chart.js）

**优先级**：P1

---

#### 2.2.3 API 限流和安全增强 ✅ V1.5（简单版）

**功能描述**：
- 实现 API 限流（用户级别、IP 级别）
- LLM API 特殊限流（防止成本过高）
- 增强 API 安全性（CORS、CSRF 防护）（基础实现）

**前置条件**：
- 用户认证增强（JWT Token）（用于用户级别限流）

**依赖关系**：
- 用户级别限流依赖 JWT Token 认证
- IP 级别限流可独立实现

**技术实现**：
- 限流中间件（express-rate-limit，内存存储）
- 安全中间件配置（基础）
- 监控和告警系统（未来）

**实现方案**：详见 [V1.5 版本规划 - API限流](./v1.5/03-API限流实现方案.md)

**扩展性**：
- 当前：内存存储（简单、零成本）
- 未来：可替换为 Redis（rate-limit-redis），接口不变

**优先级**：P0

---

#### 2.2.4 数据备份机制 ✅ V1.5（简单版）

**功能描述**：
- 实现定期数据备份（每日全量）
- 实现数据恢复工具（简单版）
- 备份文件管理（保留7天）

**前置条件**：
- 数据库已建立（基础功能）

**依赖关系**：
- 可独立开发，不依赖其他功能
- 建议在数据量增长前实现

**技术实现**：
- 数据库备份脚本（mysqldump）
- 数据恢复工具（简单版）
- 备份文件自动清理

**实现方案**：详见 [V1.5 版本规划 - 数据备份](./v1.5/09-数据备份实现方案.md)

**扩展性**：
- 当前：mysqldump + 本地文件（零成本）
- 未来：可接入云存储（OSS/S3），增量备份（binlog）

**优先级**：P0

---

---

## 3. 数据管理功能规划

### 3.1 功能目标

增强核心功能，提升用户体验，增加数据管理能力。

**前置条件**：基础功能（NPC 创建、对话历史记录）

**V1.5 版本状态**：✅ 已规划并实现

### 3.2 功能列表

#### 3.2.1 NPC 编辑和删除 ✅ V1.5

**功能描述**：
- 允许用户编辑 NPC 的配置（名称、人设、模型等）
- 允许用户删除 NPC
- 删除 NPC 时的数据清理策略（软删除或硬删除）

**前置条件**：
- NPC 创建功能

**依赖关系**：
- 删除功能需要考虑对话历史记录的关联
- 如果已实现记忆系统，需要考虑记忆数据的清理

**技术实现**：
- PUT /api/v1/agents/:id API
- DELETE /api/v1/agents/:id API
- 数据清理逻辑（软删除）

**实现方案**：详见 [V1.5 版本规划 - NPC编辑删除](./v1.5/04-NPC编辑删除实现方案.md)

**优先级**：P0

---

#### 3.2.2 短期记忆系统

**功能描述**：
- 实现 NPC 的短期记忆（最近 N 次对话的摘要）
- 在对话中使用短期记忆增强上下文
- 记忆的自动更新和管理

**前置条件**：
- 对话历史记录功能
- 事件记录系统（用于记忆触发）

**依赖关系**：
- 中期/长期记忆系统依赖此功能
- NPC 互相对话功能依赖此功能

**技术实现**：
- 记忆表设计（memories 表）
- 记忆生成服务（使用 LLM 生成摘要）
- 记忆检索和更新逻辑

**优先级**：P0

---

#### 3.2.3 对话搜索功能 ✅ V1.5（不做筛选）

**功能描述**：
- 支持搜索对话内容
- 支持关键词高亮显示
- 不做筛选功能（简化实现）

**前置条件**：
- 对话历史记录功能

**依赖关系**：
- 可独立开发，不阻塞其他功能
- 数据导出功能可以复用搜索逻辑

**技术实现**：
- 全文搜索（MySQL FULLTEXT 索引）
- 搜索 API 实现
- 前端搜索界面

**实现方案**：详见 [V1.5 版本规划 - 对话搜索](./v1.5/05-对话搜索实现方案.md)

**优先级**：P0

---

#### 3.2.4 对话筛选功能（未来）

**功能描述**：
- 支持按时间范围筛选对话
- 支持按 NPC 筛选对话
- 支持按类型筛选对话

**前置条件**：
- 对话搜索功能

**优先级**：P1

---

#### 3.2.5 数据导入导出功能 ✅ V1.5

**功能描述**：
- 支持导出对话历史（JSON、TXT、Markdown 格式）
- 支持导出 NPC 配置
- 支持导入对话历史（包含 prompt、模型信息）
- 模型兼容性处理（如果模型不存在，提供替代方案）

**前置条件**：
- 对话历史记录功能
- NPC 数据管理功能

**依赖关系**：
- 可以复用对话搜索的逻辑
- 可独立开发，不阻塞其他功能

**技术实现**：
- 导出服务实现
- 导入服务实现（模型映射）
- 文件生成和下载
- 导出格式转换

**实现方案**：详见 [V1.5 版本规划 - 数据导入导出](./v1.5/07-数据导入导出实现方案.md)

**优先级**：P1

---

## 4. 多 NPC 世界功能规划

### 4.1 功能目标

实现高级功能，打造多 NPC 世界，支持 NPC 互相对话和复杂交互。

**前置条件**：
- 单个 NPC 系统（NPC 创建、对话）
- 短期记忆系统（用于 NPC 之间的上下文）
- 事件记录系统（用于 NPC 交互事件）

### 4.2 功能列表

#### 4.2.1 多 NPC 世界场景

**功能描述**：
- 用户可以与多个 NPC 同时存在于一个场景中
- 场景可视化（2D 或 3D）
- NPC 在场景中的位置和状态

**前置条件**：
- NPC 创建功能
- 基础对话系统

**依赖关系**：
- NPC 互相对话功能依赖此功能
- NPC 关系网络功能依赖此功能

**技术实现**：
- 场景表设计（scenes 表）
- 场景管理服务
- 前端场景渲染（Canvas 或 WebGL）

**优先级**：P0

---

#### 4.2.2 NPC 互相对话

**功能描述**：
- NPC 之间可以互相对话
- 用户可以选择观察 NPC 之间的对话
- NPC 对话的触发机制（时间、事件、用户指令）

**前置条件**：
- 多 NPC 世界场景
- 短期记忆系统（用于 NPC 之间的上下文记忆）
- 事件总线架构（用于事件驱动的对话触发）

**依赖关系**：
- NPC 关系网络功能依赖此功能
- 中期/长期记忆系统可以增强此功能

**技术实现**：
- NPC 对话调度服务
- 对话事件记录（A2A 事件）
- 对话触发和规则引擎

**优先级**：P0

---

#### 4.2.3 中期/长期记忆系统

**功能描述**：
- 实现 NPC 的中期记忆（重要事件的摘要）
- 实现 NPC 的长期记忆（角色背景、关系网络）
- 记忆的检索和使用机制

**前置条件**：
- 短期记忆系统
- 事件记录系统（用于识别重要事件）

**依赖关系**：
- NPC 互相对话功能可以增强此功能
- NPC 关系网络功能依赖此功能

**技术实现**：
- 记忆分层设计（短期、中期、长期）
- 记忆生成和更新服务
- 记忆检索和融合逻辑

**优先级**：P0

---

#### 4.2.4 工具调用能力

**功能描述**：
- NPC 可以调用外部工具（搜索、知识库、计算等）
- 工具的定义和注册机制
- 工具调用的权限和安全控制

**前置条件**：
- 对话系统（基础）
- 用户认证增强（用于权限控制）

**依赖关系**：
- 可独立开发，不阻塞其他功能
- 多 NPC 世界功能可以增强工具调用场景

**技术实现**：
- 工具接口定义
- 工具注册和管理服务
- LLM Function Calling 集成

**优先级**：P1

---

#### 4.2.5 事件总线架构

**功能描述**：
- 实现事件总线，统一管理所有事件
- 支持事件订阅和发布
- 支持事件的可视化和分析

**前置条件**：
- 事件记录系统（基础）
- Redis 缓存（用于消息队列）

**依赖关系**：
- NPC 互相对话功能依赖此功能
- 多 NPC 世界功能依赖此功能
- 可以增强现有的事件记录系统

**技术实现**：
- 事件总线服务（消息队列，如 Redis Streams）
- 事件订阅和发布机制
- 事件可视化界面

**优先级**：P1

---

## 5. 长期愿景

### 5.1 产品愿景

打造一个沉浸式的 AI NPC 交互平台，让用户能够与多个具有独特人设和记忆的 AI 角色进行深度对话，满足学习、陪伴、娱乐等多种需求。

### 5.2 技术愿景

- **可扩展架构**：支持水平扩展，支持大规模用户
- **智能化**：AI 能力不断增强，NPC 行为更加自然
- **可视化**：丰富的可视化界面，展示 NPC 的行为和思维过程
- **开放平台**：支持第三方插件和扩展

### 5.3 功能愿景

#### 5.3.1 记忆系统演进

- **短期记忆**：最近对话的上下文（✅ 已实现）
- **中期记忆**：重要事件的摘要和关联（规划中，依赖短期记忆）
- **长期记忆**：角色背景、关系网络、知识库（规划中，依赖中期记忆）
- **元记忆**：NPC 对自己的记忆的认知和反思（未来，依赖长期记忆）

#### 5.3.2 交互方式演进

- **文本对话**：基础的文本对话（✅ 已实现）
- **多模态交互**：支持图片、语音、视频（未来，依赖文本对话）
- **动作系统**：NPC 可以执行动作和任务（未来，依赖工具调用能力）
- **情感系统**：NPC 具有情感状态和表达（未来，依赖记忆系统）

#### 5.3.3 世界系统演进

- **单人世界**：用户与 NPC 一对一对话（✅ 已实现）
- **多 NPC 世界**：用户与多个 NPC 共存在场景中（规划中，依赖单人世界）
- **NPC 社区**：NPC 之间形成社区和关系网络（未来，依赖多 NPC 世界、长期记忆）
- **世界规则**：世界具有物理规则、时间系统、事件系统（未来，依赖事件总线架构）

---

## 6. 技术演进方向

### 6.1 架构演进

- **当前**：单体架构，简单实现 ✅
- **演进路径 1**：引入缓存、消息队列（依赖：数据量增长、性能需求）
- **演进路径 2**：微服务架构，事件驱动（依赖：事件总线架构、多 NPC 世界）
- **未来**：分布式系统，支持大规模并发（依赖：微服务架构、监控系统）

### 6.2 技术栈演进

- **数据库**：MySQL（✅ 当前）→ 引入 Redis 缓存（依赖：性能需求）→ 引入 NoSQL（如 MongoDB）（依赖：复杂数据结构需求）
- **缓存**：无（✅ 当前）→ Redis 缓存（依赖：性能优化需求）→ Redis 集群（依赖：大规模并发）
- **消息队列**：无（✅ 当前）→ Redis Streams（依赖：事件总线架构）→ RabbitMQ / Kafka（依赖：大规模事件处理）
- **监控**：基础日志（✅ 当前）→ 错误日志和监控（✅ V1.5 简单版）→ 完整的监控和告警系统（依赖：系统稳定性需求）

### 6.3 AI 能力演进

- **LLM 模型**：OpenRouter 统一入口（✅ 当前）→ 支持更多提供商（依赖：用户需求）→ 用户自定义 API Key（依赖：权限系统）
- **Prompt 工程**：基础 system prompt（✅ 当前）→ Prompt 优化工具（依赖：用户需求）→ 智能 Prompt 优化（依赖：工具调用能力）
- **多模态**：文本对话（✅ 当前）→ 支持图片（依赖：LLM 模型支持）→ 支持语音、视频（依赖：基础设施）
- **Agent 框架**：基础实现（✅ 当前）→ 集成 LangChain（依赖：工具调用需求）→ 完整 Agent 框架（依赖：多 NPC 世界）

---

## 7. 用户反馈收集

### 7.1 反馈渠道 ✅ V1.5

- **应用内反馈**：在应用中提供反馈入口 ✅ V1.5
- **用户调研**：定期进行用户调研（未来）
- **数据分析**：分析用户行为数据（未来）
- **社区反馈**：建立用户社区（如 Discord、微信群）（未来）

**V1.5 实现**：
- 反馈提交功能（Bug、功能建议、使用问题）
- 反馈分类和状态管理
- 自动附加用户环境信息

**实现方案**：详见 [V1.5 版本规划 - 用户反馈](./v1.5/06-用户反馈实现方案.md)

### 7.2 反馈处理流程

```
收集反馈 ✅ V1.5
  ↓
分类和优先级评估（未来）
  ↓
产品规划（未来）
  ↓
开发实现（未来）
  ↓
用户通知（未来）
```

---

## 8. 竞品分析

### 8.1 竞品跟踪

- **Character.AI**：多角色对话平台
- **Replika**：AI 陪伴应用
- **ChatGPT**：通用对话助手

### 8.2 差异化策略

- **更灵活的 NPC 创建**：用户可以完全自定义 NPC 的人设和模型
- **事件驱动架构**：为未来扩展预留更多可能性
- **记忆系统**：实现分层的记忆系统，NPC 具有持续的记忆
- **多 NPC 世界**：支持多 NPC 共存和互相对话
- **数据永久保留**：承诺永久保留用户数据，除非用户主动删除
- **Agent 持续优化**：承诺随着技术发展，持续优化已有 Agent

---

## 9. 商业模式（未来考虑）

### 9.1 免费功能

- 基础 NPC 创建和对话
- 有限的对话次数
- 基础的记忆功能

### 9.2 付费功能（未来考虑）

- 无限对话次数
- 高级记忆系统
- 更多 LLM 模型选择
- 优先技术支持
- 数据导出和分析功能

---

## 10. 版本规划状态

### 10.1 V1.5 版本（当前规划）

**状态**：✅ 已规划并实现

**功能清单**：
- ✅ 密码功能（bcrypt 加密）
- ✅ JWT Token 认证
- ✅ API 限流（简单版）
- ✅ NPC 编辑和删除
- ✅ 对话搜索功能（不做筛选）
- ✅ 用户反馈功能
- ✅ 数据导入导出功能
- ✅ 错误日志和监控（简单版）
- ✅ 数据备份机制（简单版）

**详细文档**：请参考 [V1.5 版本规划](./v1.5/README.md)

### 10.2 未来版本

- **数据管理增强**：对话筛选、高级搜索
- **记忆系统**：短期、中期、长期记忆
- **多 NPC 世界**：场景管理、NPC 互相对话
- **工具调用**：LLM Function Calling
- **事件总线**：统一事件管理

---

## 11. 相关文档

- [V1 产品文档](./v1/README.md) - V1 版本完整产品文档
- [V1.5 版本规划](./v1.5/README.md) - V1.5 版本详细规划
- [V1 产品概述](./v1/01-产品概述.md) - V1 产品定义和目标
- [V1 功能需求](./v1/03-功能需求.md) - V1 功能需求详细说明

---

**文档维护**：后续规划变更时，需同步更新本文档和产品规划文档。

