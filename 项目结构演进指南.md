# 项目结构演进指南

**文档版本**：v1.1  
**最后更新**：2025-11-20  
**更新内容**：添加前端结构演进、完整映射总览表、快速查找索引  
**相关文档**：[快速开始指南](./产品文档/00-快速开始指南.md) | [开发计划](./产品文档/09-开发计划.md) | [系统架构](./产品文档/06-系统架构.md)

---

## 🔍 快速查找索引

### 按功能查找（F1-F9）

| 功能编号 | 功能名称     | 后端阶段 | 前端阶段 | 文档链接                                                    |
| -------- | ------------ | -------- | -------- | ----------------------------------------------------------- |
| F1       | 创建 NPC     | 阶段 1   | 阶段 10  | [功能需求 2.1](./产品文档/03-功能需求.md#21-f1创建-npc)     |
| F2       | NPC 列表展示 | 阶段 3   | 阶段 9   | [功能需求 2.2](./产品文档/03-功能需求.md#22-f2npc-列表展示) |
| F5       | 发送消息     | 阶段 4   | 阶段 11  | [功能需求 3.1](./产品文档/03-功能需求.md#31-f5发送消息)     |
| F6       | 获取对话历史 | 阶段 5   | 阶段 11  | [功能需求 3.2](./产品文档/03-功能需求.md#32-f6获取对话历史) |
| F8       | 事件记录     | 阶段 4   | -        | [功能需求 4.1](./产品文档/03-功能需求.md#41-f8事件记录)     |
| F9       | 事件查询     | 阶段 5   | -        | [功能需求 4.2](./产品文档/03-功能需求.md#42-f9事件查询)     |

### 按任务查找（后端 BE-001 ~ BE-016）

| 任务编号 | 任务名称           | 对应阶段  | 文档链接                                              |
| -------- | ------------------ | --------- | ----------------------------------------------------- |
| BE-001   | 项目初始化         | 阶段 0    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-002   | 数据库设计         | 阶段 2    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-003   | Agent 数据模型     | 阶段 1    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-004   | AgentService       | 阶段 1    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-005   | Agent API 路由     | 阶段 1, 3 | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-006   | Event 数据模型     | 阶段 4    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-007   | EventService       | 阶段 4    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-008   | LLMService         | 阶段 4    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-009   | MessageService     | 阶段 4    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-010   | Message API 路由   | 阶段 4    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-011   | History API 路由   | 阶段 5    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-012   | Events API 路由    | 阶段 5    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |
| BE-013   | 错误处理和日志系统 | 阶段 6    | [开发计划 3.1](./产品文档/09-开发计划.md#31-后端任务) |

### 按任务查找（前端 FE-001 ~ FE-016）

| 任务编号 | 任务名称           | 对应阶段 | 文档链接                                              |
| -------- | ------------------ | -------- | ----------------------------------------------------- |
| FE-001   | 项目初始化         | 阶段 7   | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |
| FE-002   | 基础组件库         | 阶段 8   | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |
| FE-003   | 路由和状态管理     | 阶段 8   | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |
| FE-004   | API 调用封装       | 阶段 8   | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |
| FE-005   | NPC 列表页面       | 阶段 9   | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |
| FE-006   | 创建 NPC 页面      | 阶段 10  | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |
| FE-007   | 对话页面布局       | 阶段 11  | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |
| FE-008   | 消息气泡组件       | 阶段 11  | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |
| FE-009   | 对话历史加载       | 阶段 11  | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |
| FE-010   | 消息发送功能       | 阶段 11  | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |
| FE-011   | 响应式设计         | 阶段 12  | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |
| FE-012   | 错误处理和用户提示 | 阶段 12  | [开发计划 3.2](./产品文档/09-开发计划.md#32-前端任务) |

### 按页面查找

| 页面名称    | 后端阶段  | 前端阶段 | 功能编号 | 文档链接                                                    |
| ----------- | --------- | -------- | -------- | ----------------------------------------------------------- |
| NPC 列表页  | 阶段 3    | 阶段 9   | F2       | [功能需求 2.2](./产品文档/03-功能需求.md#22-f2npc-列表展示) |
| 创建 NPC 页 | 阶段 1    | 阶段 10  | F1       | [功能需求 2.1](./产品文档/03-功能需求.md#21-f1创建-npc)     |
| 对话页面    | 阶段 4, 5 | 阶段 11  | F5, F6   | [功能需求 3.1](./产品文档/03-功能需求.md#31-f5发送消息)     |

---

## 📊 完整映射总览表

| 功能编号 | 功能名称     | 后端阶段 | 前端阶段 | 后端任务                               | 前端任务               | API 端点              | 文档链接                                                    |
| -------- | ------------ | -------- | -------- | -------------------------------------- | ---------------------- | --------------------- | ----------------------------------------------------------- |
| F1       | 创建 NPC     | 阶段 1   | 阶段 10  | BE-003, BE-004, BE-005                 | FE-006                 | POST /api/v1/agents   | [功能需求 2.1](./产品文档/03-功能需求.md#21-f1创建-npc)     |
| F2       | NPC 列表展示 | 阶段 3   | 阶段 9   | BE-005                                 | FE-005                 | GET /api/v1/agents    | [功能需求 2.2](./产品文档/03-功能需求.md#22-f2npc-列表展示) |
| F5       | 发送消息     | 阶段 4   | 阶段 11  | BE-006, BE-007, BE-008, BE-009, BE-010 | FE-007, FE-008, FE-010 | POST /api/v1/messages | [功能需求 3.1](./产品文档/03-功能需求.md#31-f5发送消息)     |
| F6       | 获取对话历史 | 阶段 5   | 阶段 11  | BE-011                                 | FE-009                 | GET /api/v1/history   | [功能需求 3.2](./产品文档/03-功能需求.md#32-f6获取对话历史) |
| F8       | 事件记录     | 阶段 4   | -        | BE-006, BE-007                         | -                      | （通过消息 API 实现） | [功能需求 4.1](./产品文档/03-功能需求.md#41-f8事件记录)     |
| F9       | 事件查询     | 阶段 5   | -        | BE-012                                 | -                      | GET /api/v1/events    | [功能需求 4.2](./产品文档/03-功能需求.md#42-f9事件查询)     |

---

## 📌 核心原则

**"按需添加结构"** 不等于"随意添加"，而是**"按任务需求添加，按验收标准验证"**。

- ✅ **有明确任务** → 添加对应结构
- ✅ **有验收标准** → 验证结构是否满足
- ✅ **有依赖关系** → 按顺序添加
- ❌ **不要提前创建** → 空文件夹和空文件

---

## 🗺️ 结构演进路线图

### 后端结构演进

```
阶段 0：最小化初始化
  ├─ 基础文件（server.js, package.json, .env）
  └─ 验收：服务器能启动

阶段 1：第一个 API（创建 NPC）
  ├─ routes/agents.js
  ├─ services/AgentService.js
  ├─ repositories/AgentRepository.js
  ├─ config/database.js（数据库连接）
  └─ 验收：能通过 API 创建 NPC

阶段 2：数据库操作
  ├─ migrations/（数据库迁移脚本）
  └─ 验收：数据库表创建成功

阶段 3：获取 NPC 列表 API
  └─ 验收：能通过 API 获取列表

阶段 4：对话功能（发送消息）
  ├─ routes/messages.js
  ├─ services/MessageService.js
  ├─ services/EventService.js
  ├─ services/LLMService.js
  └─ 验收：能发送消息并收到回复

阶段 5：对话历史
  ├─ routes/history.js
  └─ 验收：能获取对话历史

阶段 6：错误处理和工具
  ├─ middleware/errorHandler.js
  ├─ utils/validator.js
  ├─ utils/logger.js
  └─ 验收：错误处理统一，日志正常
```

### 前端结构演进

```
阶段 7：前端项目初始化
  ├─ 基础文件（package.json, vite.config.js）
  └─ 验收：前端项目能启动

阶段 8：基础框架和组件库
  ├─ components/（基础组件）
  ├─ utils/api.js（API 封装）
  ├─ router/（路由配置）
  └─ 验收：基础组件可用，API 能调用

阶段 9：NPC 列表页面
  ├─ pages/AgentList.jsx
  ├─ components/AgentCard.jsx
  └─ 验收：能显示 NPC 列表

阶段 10：创建 NPC 页面
  ├─ pages/CreateAgent.jsx
  ├─ components/AgentForm.jsx
  └─ 验收：能创建 NPC

阶段 11：对话页面
  ├─ pages/Chat.jsx
  ├─ components/MessageBubble.jsx
  ├─ components/MessageInput.jsx
  └─ 验收：能发送消息并显示回复

阶段 12：优化和测试
  ├─ 响应式设计
  ├─ 错误处理
  └─ 验收：UI 优化完成，错误处理完善
```

---

## 📋 详细结构演进表

### 阶段 0：项目初始化

#### 目标

让项目能启动，返回基础响应。

#### 任务

- [ ] 任务 0.2：初始化后端项目

#### 需要的结构

```
npc-backend/
├── package.json          # npm 配置
├── .env                  # 环境变量（模板）
├── .env.example          # 环境变量示例
├── .gitignore           # Git 忽略文件
├── server.js             # 入口文件（最简单的 Express）
└── README.md            # 项目说明
```

#### 验收标准

- [ ] 运行 `npm start` 服务器能启动
- [ ] 访问 `http://localhost:8000` 能看到响应
- [ ] 访问 `http://localhost:8000/api/v1/health` 返回健康检查响应
- [ ] `.env` 文件已创建（包含端口、数据库连接等配置项）

#### 触发条件

- **何时添加**：开始初始化项目时
- **何时完成**：服务器能正常启动并响应

#### 文档链接

- 开发计划：[BE-001：项目初始化和环境搭建](./产品文档/09-开发计划.md#be-001-项目初始化和环境搭建)
- 快速开始指南：[任务 0.2：初始化后端项目](./产品文档/00-快速开始指南.md#任务-02初始化后端项目)

---

### 阶段 1：第一个 API（创建 NPC）

#### 目标

实现创建 NPC 的 API，能保存到数据库。

#### 任务

- [ ] 任务 1.1：创建数据库表
- [ ] 任务 1.2：实现创建 NPC API

#### 需要的结构

```
npc-backend/
├── ...（阶段 0 的文件）
├── config/
│   └── database.js       # 数据库连接配置
├── routes/
│   └── agents.js         # NPC 管理路由
├── services/
│   └── AgentService.js   # NPC 业务逻辑
└── repositories/
    └── AgentRepository.js # NPC 数据访问
```

#### 验收标准

- [ ] `config/database.js` 存在，能连接 MySQL
- [ ] `routes/agents.js` 存在，包含 `POST /api/v1/agents` 路由
- [ ] `services/AgentService.js` 存在，包含 `createAgent` 方法
- [ ] `repositories/AgentRepository.js` 存在，包含数据库操作
- [ ] 能通过 API 成功创建 NPC（返回 agentId）
- [ ] 数据能保存到数据库 `agents` 表

#### 触发条件

- **何时添加**：开始实现"创建 NPC API"任务时
- **何时完成**：API 测试通过，数据能保存到数据库

#### 文档链接

- 功能需求：[F1：创建 NPC](./产品文档/03-功能需求.md#21-f1创建-npc)
- API 设计：[POST /api/v1/agents](./产品文档/04-API设计.md#31-创建-npc)
- 数据模型：[agents 表](./产品文档/05-数据模型.md#21-agents-表)
- 开发计划：[BE-003, BE-004, BE-005](./产品文档/09-开发计划.md#31-后端任务)
- 快速开始指南：[任务 1.2：实现创建 NPC API](./产品文档/00-快速开始指南.md#任务-12实现创建-npc-api)

---

### 阶段 2：数据库迁移

#### 目标

使用迁移脚本管理数据库结构。

#### 任务

- [ ] 任务 1.1：创建数据库表（使用迁移脚本）

#### 需要的结构

```
npc-backend/
├── ...（之前的文件）
└── migrations/
    └── 001_create_agents_table.sql  # 创建 agents 表的 SQL
```

#### 验收标准

- [ ] `migrations/` 文件夹存在
- [ ] 迁移脚本能成功执行
- [ ] 数据库表结构符合数据模型文档

#### 触发条件

- **何时添加**：需要管理数据库结构变更时
- **何时完成**：迁移脚本执行成功，表创建完成

#### 文档链接

- 开发计划：[BE-002：数据库设计和迁移脚本](./产品文档/09-开发计划.md#be-002-数据库设计和迁移脚本)
- 数据模型：[数据库设计](./产品文档/05-数据模型.md)
- 快速开始指南：[任务 1.1：创建数据库表](./产品文档/00-快速开始指南.md#任务-11创建数据库表)

---

### 阶段 3：获取 NPC 列表 API

#### 目标

实现获取 NPC 列表的 API。

#### 任务

- [ ] 任务 1.3：实现获取 NPC 列表 API

#### 需要的结构

```
npc-backend/
├── ...（之前的文件）
└── routes/
    └── agents.js         # 已存在，添加 GET /api/v1/agents 路由
```

**注意**：不需要创建新文件，只需要在现有文件中添加路由。

#### 验收标准

- [ ] `routes/agents.js` 包含 `GET /api/v1/agents` 路由
- [ ] `services/AgentService.js` 包含 `getAgentList` 方法
- [ ] `repositories/AgentRepository.js` 包含查询列表的方法
- [ ] 能通过 API 获取 NPC 列表
- [ ] 列表按最后对话时间排序

#### 触发条件

- **何时添加**：开始实现"获取 NPC 列表 API"任务时
- **何时完成**：API 测试通过，能返回列表

#### 文档链接

- 功能需求：[F2：NPC 列表展示](./产品文档/03-功能需求.md#22-f2npc-列表展示)
- API 设计：[GET /api/v1/agents](./产品文档/04-API设计.md#32-获取-npc-列表)
- 开发计划：[BE-005：Agent API 路由实现](./产品文档/09-开发计划.md#be-005-agent-api-路由实现)
- 快速开始指南：[任务 1.3：实现获取 NPC 列表 API](./产品文档/00-快速开始指南.md#任务-13实现获取-npc-列表-api)

---

### 阶段 4：对话功能（发送消息）

#### 目标

实现发送消息并收到 AI 回复的功能。

#### 任务

- [ ] 任务 2.1：创建 events 表
- [ ] 任务 2.2：集成 LLM API
- [ ] 任务 2.3：实现发送消息 API

#### 需要的结构

```
npc-backend/
├── ...（之前的文件）
├── routes/
│   └── messages.js       # 消息路由
├── services/
│   ├── MessageService.js # 消息业务逻辑
│   ├── EventService.js   # 事件业务逻辑
│   └── LLMService.js     # LLM API 调用
└── repositories/
    └── EventRepository.js # 事件数据访问
```

#### 验收标准

- [ ] `routes/messages.js` 存在，包含 `POST /api/v1/messages` 路由
- [ ] `services/MessageService.js` 存在，包含 `sendMessage` 方法
- [ ] `services/EventService.js` 存在，包含事件创建和查询方法
- [ ] `services/LLMService.js` 存在，能调用 LLM API
- [ ] `repositories/EventRepository.js` 存在，包含事件数据库操作
- [ ] 能通过 API 发送消息并收到 AI 回复
- [ ] 消息和回复都保存到 `events` 表

#### 触发条件

- **何时添加**：开始实现"发送消息 API"任务时
- **何时完成**：API 测试通过，能收到 AI 回复

#### 文档链接

- 功能需求：[F5：发送消息](./产品文档/03-功能需求.md#31-f5发送消息) | [F8：事件记录](./产品文档/03-功能需求.md#41-f8事件记录)
- API 设计：[POST /api/v1/messages](./产品文档/04-API设计.md#33-发送消息)
- 数据模型：[events 表](./产品文档/05-数据模型.md#22-events-表)
- 开发计划：[BE-006, BE-007, BE-008, BE-009, BE-010](./产品文档/09-开发计划.md#31-后端任务)
- 快速开始指南：[任务 2.3：实现发送消息 API](./产品文档/00-快速开始指南.md#任务-23实现发送消息-api)

---

### 阶段 5：对话历史

#### 目标

实现获取对话历史的功能。

#### 任务

- [ ] 任务 2.4：实现获取对话历史 API

#### 需要的结构

```
npc-backend/
├── ...（之前的文件）
└── routes/
    └── history.js         # 历史记录路由
```

**注意**：`EventService` 和 `EventRepository` 已在阶段 4 创建，这里只需要添加路由。

#### 验收标准

- [ ] `routes/history.js` 存在，包含 `GET /api/v1/history` 路由
- [ ] 能通过 API 获取对话历史
- [ ] 历史记录按时间顺序排列
- [ ] 只返回当前用户和当前 NPC 的对话

#### 触发条件

- **何时添加**：开始实现"获取对话历史 API"任务时
- **何时完成**：API 测试通过，能返回历史记录

#### 文档链接

- 功能需求：[F6：获取对话历史](./产品文档/03-功能需求.md#32-f6获取对话历史) | [F9：事件查询](./产品文档/03-功能需求.md#42-f9事件查询)
- API 设计：[GET /api/v1/history](./产品文档/04-API设计.md#34-获取对话历史) | [GET /api/v1/events](./产品文档/04-API设计.md#35-查询事件记录)
- 开发计划：[BE-011, BE-012](./产品文档/09-开发计划.md#be-011-history-api-路由实现)
- 快速开始指南：[任务 2.4：实现获取对话历史 API](./产品文档/00-快速开始指南.md#任务-24实现获取对话历史-api)

---

### 阶段 6：错误处理和工具

#### 目标

统一错误处理，添加日志和验证工具。

#### 任务

- [ ] 任务 3.1：完善错误处理

#### 需要的结构

```
npc-backend/
├── ...（之前的文件）
├── middleware/
│   └── errorHandler.js   # 统一错误处理中间件
└── utils/
    ├── validator.js       # 数据验证工具
    └── logger.js          # 日志工具
```

#### 验收标准

- [ ] `middleware/errorHandler.js` 存在，能统一处理错误
- [ ] `utils/validator.js` 存在，能验证请求参数
- [ ] `utils/logger.js` 存在，能记录日志
- [ ] 所有 API 错误都使用统一格式返回
- [ ] 日志能正常记录请求和错误

#### 触发条件

- **何时添加**：开始完善错误处理时
- **何时完成**：错误处理统一，日志正常

#### 文档链接

- 开发计划：[BE-013：错误处理和日志系统](./产品文档/09-开发计划.md#be-013-错误处理和日志系统)
- 非功能需求：[错误处理](./产品文档/08-非功能需求.md#错误处理)
- 快速开始指南：[任务 3.1：完善错误处理](./产品文档/00-快速开始指南.md#任务-31完善错误处理)

---

## 📋 前端结构演进表

### 阶段 7：前端项目初始化

#### 目标

让前端项目能启动，显示基础页面。

#### 任务

- [ ] 任务 0.3：初始化前端项目

#### 需要的结构

```
npc-frontend/
├── package.json          # npm 配置
├── vite.config.js        # Vite 配置
├── .env                  # 环境变量（API 地址）
├── .gitignore           # Git 忽略文件
├── index.html           # HTML 入口
├── src/
│   ├── main.jsx         # React 入口
│   ├── App.jsx          # 根组件
│   └── index.css        # 全局样式
└── README.md            # 项目说明
```

#### 验收标准

- [ ] 运行 `npm run dev` 前端项目能启动
- [ ] 访问 `http://localhost:3000` 能看到页面
- [ ] `.env` 文件已创建（包含 API 基础地址）
- [ ] 项目能正常构建（`npm run build`）

#### 触发条件

- **何时添加**：开始初始化前端项目时
- **何时完成**：前端项目能正常启动并显示页面

#### 文档链接

- 开发计划：[FE-001：项目初始化和环境搭建](./产品文档/09-开发计划.md#fe-001-项目初始化和环境搭建)
- 快速开始指南：[任务 0.3：初始化前端项目](./产品文档/00-快速开始指南.md#任务-03初始化前端项目)

---

### 阶段 8：基础框架和组件库

#### 目标

搭建前端基础框架，实现基础组件和 API 封装。

#### 任务

- [ ] 任务 1.4：实现基础组件库
- [ ] 任务 1.5：配置路由和状态管理
- [ ] 任务 1.6：实现 API 调用封装

#### 需要的结构

```
npc-frontend/
├── ...（阶段 7 的文件）
├── src/
│   ├── components/
│   │   ├── Button.jsx      # 按钮组件
│   │   ├── Input.jsx       # 输入框组件
│   │   ├── Card.jsx        # 卡片组件
│   │   └── Loading.jsx     # 加载组件
│   ├── utils/
│   │   └── api.js          # API 调用封装
│   ├── router/
│   │   └── index.jsx       # 路由配置
│   └── store/              # 状态管理（如需要）
│       └── index.js
```

#### 验收标准

- [ ] `components/` 文件夹存在，包含基础组件
- [ ] `utils/api.js` 存在，能调用后端 API
- [ ] `router/` 文件夹存在，路由配置完成
- [ ] 基础组件能正常使用（Button、Input、Card 等）
- [ ] API 封装能正常调用后端接口

#### 触发条件

- **何时添加**：开始实现基础组件和 API 封装时
- **何时完成**：基础组件可用，API 能正常调用

#### 文档链接

- 开发计划：[FE-002, FE-003, FE-004](./产品文档/09-开发计划.md#32-前端任务)
- UI 设计规范：[组件设计](./产品文档/07-UI设计规范.md#组件设计)

---

### 阶段 9：NPC 列表页面

#### 目标

实现 NPC 列表页面，能显示所有 NPC。

#### 任务

- [ ] 任务 1.5：实现前端 NPC 列表页面

#### 需要的结构

```
npc-frontend/
├── ...（之前的文件）
├── src/
│   ├── pages/
│   │   └── AgentList.jsx   # NPC 列表页面
│   └── components/
│       └── AgentCard.jsx   # NPC 卡片组件
```

#### 验收标准

- [ ] `pages/AgentList.jsx` 存在，能显示 NPC 列表
- [ ] `components/AgentCard.jsx` 存在，能显示单个 NPC 卡片
- [ ] 能通过 API 获取 NPC 列表并显示
- [ ] 点击卡片能跳转到对话页面
- [ ] 空状态和加载状态处理正确

#### 触发条件

- **何时添加**：开始实现"NPC 列表页面"任务时
- **何时完成**：页面能正常显示 NPC 列表，点击能跳转

#### 文档链接

- 功能需求：[F2：NPC 列表展示](./产品文档/03-功能需求.md#22-f2npc-列表展示)
- UI 设计规范：[NPC 列表页](./产品文档/07-UI设计规范.md#npc-列表页)
- 开发计划：[FE-005：NPC 列表页面实现](./产品文档/09-开发计划.md#fe-005-npc-列表页面实现)
- 快速开始指南：[任务 1.5：实现前端 NPC 列表页面](./产品文档/00-快速开始指南.md#任务-15实现前端-npc-列表页面)

---

### 阶段 10：创建 NPC 页面

#### 目标

实现创建 NPC 页面，能通过表单创建新 NPC。

#### 任务

- [ ] 任务 1.4：实现前端创建 NPC 页面

#### 需要的结构

```
npc-frontend/
├── ...（之前的文件）
├── src/
│   ├── pages/
│   │   └── CreateAgent.jsx # 创建 NPC 页面
│   └── components/
│       └── AgentForm.jsx   # NPC 表单组件
```

#### 验收标准

- [ ] `pages/CreateAgent.jsx` 存在，能显示创建表单
- [ ] `components/AgentForm.jsx` 存在，包含所有必填字段
- [ ] 表单验证正确（前端验证）
- [ ] 能通过 API 成功创建 NPC
- [ ] 创建成功后跳转到 NPC 列表页

#### 触发条件

- **何时添加**：开始实现"创建 NPC 页面"任务时
- **何时完成**：能通过表单成功创建 NPC

#### 文档链接

- 功能需求：[F1：创建 NPC](./产品文档/03-功能需求.md#21-f1创建-npc)
- UI 设计规范：[创建 NPC 页](./产品文档/07-UI设计规范.md#创建-npc-页)
- 开发计划：[FE-006：创建 NPC 页面实现](./产品文档/09-开发计划.md#fe-006-创建-npc-页面实现)
- 快速开始指南：[任务 1.4：实现前端创建 NPC 页面](./产品文档/00-快速开始指南.md#任务-14实现前端创建-npc-页面)

---

### 阶段 11：对话页面

#### 目标

实现对话页面，能发送消息并显示 AI 回复。

#### 任务

- [ ] 任务 2.5：实现前端对话页面
- [ ] 任务 2.6：实现前端对话历史加载

#### 需要的结构

```
npc-frontend/
├── ...（之前的文件）
├── src/
│   ├── pages/
│   │   └── Chat.jsx         # 对话页面
│   └── components/
│       ├── MessageBubble.jsx # 消息气泡组件
│       └── MessageInput.jsx  # 消息输入框组件
```

#### 验收标准

- [ ] `pages/Chat.jsx` 存在，能显示对话界面
- [ ] `components/MessageBubble.jsx` 存在，能显示消息气泡
- [ ] `components/MessageInput.jsx` 存在，能输入和发送消息
- [ ] 能通过 API 发送消息并显示回复
- [ ] 能加载并显示对话历史
- [ ] 自动滚动到底部功能正常
- [ ] 加载状态和空状态处理正确

#### 触发条件

- **何时添加**：开始实现"对话页面"任务时
- **何时完成**：能发送消息并显示回复，历史记录正常加载

#### 文档链接

- 功能需求：[F5：发送消息](./产品文档/03-功能需求.md#31-f5发送消息) | [F6：获取对话历史](./产品文档/03-功能需求.md#32-f6获取对话历史)
- UI 设计规范：[对话页面](./产品文档/07-UI设计规范.md#对话页面)
- 开发计划：[FE-007, FE-008, FE-009, FE-010](./产品文档/09-开发计划.md#32-前端任务)
- 快速开始指南：[任务 2.5：实现前端对话页面](./产品文档/00-快速开始指南.md#任务-25实现前端对话页面)

---

### 阶段 12：优化和测试

#### 目标

完善 UI 优化、错误处理和测试。

#### 任务

- [ ] 任务 3.2：UI 优化
- [ ] 任务 3.3：测试和修复 Bug

#### 需要的结构

```
npc-frontend/
├── ...（之前的文件）
├── src/
│   ├── components/
│   │   └── ErrorBoundary.jsx # 错误边界组件
│   └── utils/
│       └── errorHandler.js   # 错误处理工具
```

#### 验收标准

- [ ] 响应式设计完成（移动端适配）
- [ ] 错误处理完善（统一错误提示）
- [ ] 加载状态和动画优化
- [ ] 浏览器兼容性测试通过
- [ ] 主要 Bug 已修复

#### 触发条件

- **何时添加**：开始优化和测试时
- **何时完成**：UI 优化完成，测试通过

#### 文档链接

- 开发计划：[FE-011, FE-012, FE-015, FE-016](./产品文档/09-开发计划.md#32-前端任务)
- UI 设计规范：[响应式设计](./产品文档/07-UI设计规范.md#响应式设计)
- 快速开始指南：[任务 3.2：UI 优化](./产品文档/00-快速开始指南.md#任务-32ui-优化)

---

## ✅ 结构添加检查清单

每次添加新结构前，检查：

- [ ] **有明确任务**：当前任务需要这个结构吗？
- [ ] **有验收标准**：这个结构完成后如何验证？
- [ ] **有依赖关系**：是否需要先完成其他任务？
- [ ] **不重复创建**：这个结构是否已存在？

---

## 📊 结构演进对照表

### 后端结构演进

| 阶段 | 功能编号 | 任务         | 新增结构                                              | 验收标准                 | 文档参考                                                               |
| ---- | -------- | ------------ | ----------------------------------------------------- | ------------------------ | ---------------------------------------------------------------------- |
| 0    | -        | 初始化项目   | `server.js`, `package.json`, `.env`                   | 服务器能启动             | [快速开始指南](./产品文档/00-快速开始指南.md)                          |
| 1    | F1       | 创建 NPC API | `routes/`, `services/`, `repositories/`, `config/`    | API 能创建 NPC           | [任务 1.2](./产品文档/00-快速开始指南.md#任务-12实现创建-npc-api)      |
| 2    | -        | 数据库迁移   | `migrations/`                                         | 表创建成功               | [任务 1.1](./产品文档/00-快速开始指南.md#任务-11创建数据库表)          |
| 3    | F2       | 获取列表 API | （无新增，扩展现有文件）                              | API 能返回列表           | [任务 1.3](./产品文档/00-快速开始指南.md#任务-13实现获取-npc-列表-api) |
| 4    | F5, F8   | 发送消息 API | `routes/messages.js`, `services/MessageService.js` 等 | API 能发送消息并收到回复 | [任务 2.3](./产品文档/00-快速开始指南.md#任务-23实现发送消息-api)      |
| 5    | F6, F9   | 对话历史 API | `routes/history.js`                                   | API 能返回历史           | [任务 2.4](./产品文档/00-快速开始指南.md#任务-24实现获取对话历史-api)  |
| 6    | -        | 错误处理     | `middleware/`, `utils/`                               | 错误处理统一             | [任务 3.1](./产品文档/00-快速开始指南.md#任务-31完善错误处理)          |

### 前端结构演进

| 阶段 | 功能编号 | 任务           | 新增结构                                            | 验收标准                 | 文档参考                                                               |
| ---- | -------- | -------------- | --------------------------------------------------- | ------------------------ | ---------------------------------------------------------------------- |
| 7    | -        | 初始化项目     | `package.json`, `vite.config.js`, `src/`            | 前端项目能启动           | [任务 0.3](./产品文档/00-快速开始指南.md#任务-03初始化前端项目)        |
| 8    | -        | 基础框架和组件 | `components/`, `utils/api.js`, `router/`            | 基础组件可用，API 能调用 | [开发计划 FE-002~004](./产品文档/09-开发计划.md#32-前端任务)           |
| 9    | F2       | NPC 列表页面   | `pages/AgentList.jsx`, `components/AgentCard.jsx`   | 能显示 NPC 列表          | [任务 1.5](./产品文档/00-快速开始指南.md#任务-15实现前端-npc-列表页面) |
| 10   | F1       | 创建 NPC 页面  | `pages/CreateAgent.jsx`, `components/AgentForm.jsx` | 能创建 NPC               | [任务 1.4](./产品文档/00-快速开始指南.md#任务-14实现前端创建-npc-页面) |
| 11   | F5, F6   | 对话页面       | `pages/Chat.jsx`, `components/MessageBubble.jsx` 等 | 能发送消息并显示回复     | [任务 2.5](./产品文档/00-快速开始指南.md#任务-25实现前端对话页面)      |
| 12   | -        | 优化和测试     | `components/ErrorBoundary.jsx` 等                   | UI 优化完成，测试通过    | [任务 3.2](./产品文档/00-快速开始指南.md#任务-32ui-优化)               |

---

## 🎯 使用方式

### 1. 开始新任务时

1. 查看"结构演进对照表"，找到对应阶段
2. 查看"需要的结构"，了解需要创建什么
3. 查看"验收标准"，明确完成标准
4. 开始实现任务，按需创建结构

### 2. 不确定是否需要添加结构时

1. 查看"触发条件"：当前任务是否需要这个结构？
2. 查看"验收标准"：如果没有这个结构，能否通过验收？
3. 如果答案都是"是"，则添加；否则不添加

### 3. 完成任务后

1. 对照"验收标准"，逐项检查
2. 所有项都通过 → 任务完成
3. 有项未通过 → 继续完善

---

## 📚 相关文档

- [快速开始指南](./产品文档/00-快速开始指南.md) - 详细的任务步骤
- [开发计划](./产品文档/09-开发计划.md) - 完整的任务清单和时间规划
- [系统架构](./产品文档/06-系统架构.md) - 最终的目标架构（参考用）
- [功能需求](./产品文档/03-功能需求.md) - 功能需求和验收标准

---

## 💡 重要提示

1. **不要提前创建**：只创建当前任务需要的结构
2. **参考架构文档**：了解最终目标，但不强制一开始就达到
3. **按任务推进**：每个任务都有明确的验收标准
4. **逐步完善**：结构会随着任务逐步完善，最终达到架构文档的目标

---

**记住**：结构是手段，不是目的。目标是完成功能，结构是为了更好地组织代码。
