# 前后端分开开发思想

**来源**：`产品文档/v1/07-开发设计思想.md`  
**适用场景**：前后端分离项目开发，提高开发效率

---

## 🎯 核心思想

**前后端分开开发思想**（不是前后端分离架构）

这是一种开发方法论，而非架构模式。核心思想是：

- **前后端可以独立开发**：前端和后端可以完全独立地进行开发和测试
- **前端可以用假数据尝试不同展现形式**：前端可以使用 Mock 数据，快速尝试不同的 UI 设计和交互方式
- **后端可以不接前端，设想功能并实现**：后端可以独立实现功能，通过测试验证效果，不需要等待前端完成
- **API 适配层作为桥梁**：通过 API 适配层实现前后端的解耦和切换

---

## 🏗️ API 适配层设计

### 架构设计

```
业务代码（前端组件）
    ↓
统一 API 接口（api/index.js）
    ↓
API 适配器（Adapter Pattern）
    ├── Mock 适配器（mockAdapter.js）
    │   └── 返回假数据
    └── HTTP 适配器（httpAdapter.js）
        └── 调用后端 API
```

### 自动检测后端可用性

**自动切换机制**：

```javascript
async function checkBackendAvailable(baseURL) {
  try {
    const response = await fetch(`${baseURL}/api/v1/health`, {
      signal: AbortSignal.timeout(2000) // 2秒超时
    });
    return response.ok && (await response.json()).success === true;
  } catch (error) {
    return false; // 网络错误、超时等，返回 false
  }
}

async function createApi(mode = null) {
  const apiMode = mode || import.meta.env.VITE_API_MODE || 'auto';
  
  if (apiMode === 'mock') {
    return new MockAdapter(); // 强制使用 Mock
  }
  
  if (apiMode === 'http') {
    return new HttpAdapter(); // 强制使用 HTTP
  }
  
  // 自动检测模式
  const isBackendAvailable = await checkBackendAvailable(baseURL);
  
  if (isBackendAvailable) {
    return new HttpAdapter(); // 后端可用，使用 HTTP
  } else {
    return new MockAdapter(); // 后端不可用，使用 Mock
  }
}
```

**工作原理**：

1. **环境变量控制**：通过 `VITE_API_MODE` 环境变量控制模式（`mock`、`http`、`auto`）
2. **自动检测**：如果模式为 `auto`，自动检测后端健康检查端点
3. **自动切换**：后端可用时使用 HTTP 适配器，不可用时使用 Mock 适配器
4. **延迟检测**：如果立即检测失败，等待 10 秒后再检测一次（给后端启动时间）

---

## 🚀 开发流程

### 前端开发流程

**使用 Mock 数据开发**：

1. **前端独立开发**：前端开发者使用 Mock 适配器，不依赖后端
2. **快速迭代 UI**：可以快速尝试不同的 UI 设计和交互方式
3. **模拟各种场景**：可以模拟成功、失败、延迟等各种场景
4. **后端完成后切换**：后端完成后，自动切换到 HTTP 适配器

### 后端开发流程

**独立实现功能**：

1. **设想功能**：后端开发者根据需求文档，设想功能实现
2. **实现功能**：独立实现功能，不依赖前端
3. **编写测试**：编写单元测试和集成测试，验证功能正确性
4. **前端集成**：前端通过 HTTP 适配器调用后端 API

---

## ✅ 设计优势

### 开发效率提升

- **并行开发**：前后端可以并行开发，不互相阻塞
- **快速迭代**：前端可以快速尝试不同的 UI 设计，无需等待后端
- **独立测试**：前后端可以独立测试，提高测试效率

### 开发灵活性

- **UI 快速迭代**：前端可以使用 Mock 数据，快速尝试不同的 UI 设计
- **功能独立实现**：后端可以独立实现功能，通过测试验证效果
- **易于切换**：通过适配层，可以轻松切换 Mock 和 HTTP 模式

### 代码质量提升

- **接口规范**：统一的 API 接口规范，确保前后端接口一致
- **错误处理**：统一的错误处理，提高代码健壮性
- **类型安全**：通过适配层，可以统一数据类型，提高类型安全

---

## 📝 注意事项

### Mock 数据维护

- **保持一致性**：Mock 数据应与后端 API 返回格式保持一致
- **及时更新**：后端 API 变更时，及时更新 Mock 数据
- **覆盖场景**：Mock 数据应覆盖各种场景（成功、失败、边界情况）

### 适配层维护

- **接口规范**：保持统一的 API 接口规范，确保前后端一致
- **错误处理**：统一的错误处理，确保错误信息一致
- **数据格式**：统一的数据格式，确保前后端数据一致

---

