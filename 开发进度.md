# 开发进度记录

> 本文档用于记录开发进度，方便与 AI 助手同步消息。
> 每次完成任务后，请更新本文档。
>
> **重要规范**：AI 助手在记录日志时，必须先通过工具获取当天时间，确保日期准确。

---

## 当前状态

- **后端阶段**：阶段 5 - 对话历史（已完成 ✅）+ 用户认证（已完成 ✅）+ 数据库迁移（已完成 ✅）
- **前端阶段**：阶段 13 - 对接真实 API（已完成 ✅）+ 用户认证 UI（已完成 ✅）+ 移动端自适应（已完成 ✅）
- **当前任务**：前后端核心功能已完成，包括用户认证、NPC 管理、对话功能；数据库迁移已完成；短轮询、Markdown 渲染、自动刷新、移动端自适应等功能已实现
- **开始时间**：2025-11-21
- **预计完成**：待定

---

## 已完成任务

- [x] 任务 0.1：确定技术栈（2025-11-19）
- [x] 任务 0.2：安装开发环境软件（部分完成，2025-11-20）
  - [x] Node.js（v18+）
  - [x] MySQL
  - [ ] Insomnia（待安装）
  - [ ] ~~Docker Desktop~~（暂缓）
- [x] 任务 0.3：初始化后端项目（2025-11-20）
  - [x] 创建项目目录 `npc-backend/`
  - [x] 初始化 npm 项目
  - [x] 安装基础依赖（express, cors, dotenv, nodemon）
  - [x] 创建 `server.js` 入口文件
  - [x] 创建 `.env` 和 `.env.example` 配置文件
  - [x] 创建 `.gitignore` 文件
  - [x] 创建 `README.md` 项目说明
  - [x] 配置 `package.json` 启动脚本
- [x] 任务 0.4：初始化前端项目（2025-11-20）
  - [x] 创建项目目录 `npc-frontend/`
  - [x] 初始化 npm 项目（React + Vite）
  - [x] 安装基础依赖（react, react-dom, vite, @vitejs/plugin-react）
  - [x] 创建 `vite.config.js` 配置文件
  - [x] 创建 `index.html` HTML 入口
  - [x] 创建 `src/main.jsx` React 入口文件
  - [x] 创建 `src/App.jsx` 根组件
  - [x] 创建 `src/index.css` 全局样式
  - [x] 创建 `.env.example` 环境变量示例
  - [x] 创建 `.gitignore` 文件
  - [x] 创建 `README.md` 项目说明
  - [x] 配置 `package.json` 启动脚本
  - [x] 验证项目能正常启动（`npm run dev`）
- [x] 任务 0.5：创建一键启动脚本（2025-11-20）
  - [x] 在根目录创建 `package.json` 配置文件
  - [x] 安装 `concurrently` 依赖（用于同时运行多个命令）
  - [x] 创建 `start.js` Node.js 启动脚本（备用方案）
  - [x] 配置 `npm run dev` 一键启动命令
  - [x] 创建根目录 `README.md` 项目说明文档
- [x] **阶段 1：创建 NPC API**（2025-11-20）
  - [x] 创建 `config/models.js` - 模型配置管理（从环境变量读取）
  - [x] 创建 `repositories/AgentRepository.js` - 数据访问层（方案 C：独立存储 + 用户关系索引）
  - [x] 创建 `services/AgentService.js` - 业务逻辑层（字段验证、名称唯一性检查、模型验证）
  - [x] 创建 `routes/agents.js` - API 路由（POST /api/v1/agents, GET /api/v1/agents）
  - [x] 修改 `server.js` - 注册 agents 路由
  - [x] 更新 `.env` - 添加模型配置（MODELS 环境变量）
  - [x] 实现 ID 生成策略：`agent_${timestamp}_${random}`
  - [x] 实现存储结构：独立存储 + 用户关系索引 + 用户名称索引
  - [x] 实现模型验证：从环境变量读取支持的模型列表
  - [x] API 测试通过：
    - ✅ POST /api/v1/agents - 创建 NPC 成功
    - ✅ GET /api/v1/agents?userId=xxx - 获取列表成功（按创建时间倒序）
    - ✅ 名称重复验证成功（返回 DUPLICATE_NAME 错误）
    - ✅ 字段验证成功（名称为空、模型无效等）
    - ✅ 多用户支持成功（不同用户数据隔离）

---

## 进行中任务

- 无（所有核心功能已完成）

---

## 遇到的问题

> **注意**：所有问题已迁移到 [实现问题记录.md](./实现问题记录.md) 文档中统一管理。
> 
> 已迁移的问题：
> - PROB-007：前端发送消息后，AI 回复不显示
> - PROB-008：刷新 Agent 页面后出现"NPC 不存在或无权访问"错误
> - PROB-009：AgentList 页面首次加载时显示 Mock 状态提示
> - PROB-010：AgentList 页面首次加载时不显示已存在的 agents
> - PROB-011：HTTP 适配器解析非 JSON 响应时出错
>
> 详细内容请查看：[实现问题记录.md](./实现问题记录.md)

---

## 下一步计划

### 优先任务（后端开发）

- [x] **阶段 1：创建 NPC API**（已完成 ✅）

  - [x] 任务 1.1：创建路由结构（routes/agents.js）
  - [x] 任务 1.2：创建服务层（services/AgentService.js）
  - [x] 任务 1.3：创建数据访问层（repositories/AgentRepository.js，使用内存存储）
  - [x] 任务 1.4：实现 POST /api/v1/agents 接口
  - [x] 任务 1.5：实现 GET /api/v1/agents 接口（获取列表）
  - [x] 验收：能通过 API 创建和获取 NPC（使用内存数据）✅

- [x] **阶段 4 部分任务**（进行中）

  - [x] 任务 2.0：创建 Repository 层（数据访问层）✅
    - [x] 创建 SessionRepository.js（Session 数据访问）
    - [x] 创建 EventRepository.js（Event 数据访问）
    - [x] 实现中心化存储 + 参与者索引的存储结构
    - [x] 实现参与者标准化排序
    - [x] 实现单会话模式
    - [x] 预留未来功能（主题筛选等，已实现但未使用）
    - [x] 重构：分离 Session 和 Event 的存储（符合单一职责原则）
  - [x] 任务 2.1：创建 Service 层（业务逻辑层）✅
    - [x] 创建 SessionService.js（Session 业务逻辑）
    - [x] 创建 EventService.js（Event 业务逻辑）
    - [x] 实现事件创建和查询方法
    - [x] 实现会话管理方法
    - [x] 实现事件数据验证
    - [x] 实现业务规则检查
    - [x] 预留未来功能（主题筛选，已实现但未使用）
    - [x] 重构：分离 Session 和 Event 的业务逻辑（符合单一职责原则）
  - [x] 任务 2.2：创建 LLMService（services/LLMService.js）✅
    - [x] 支持 OpenAI、DeepSeek、OpenRouter 三个提供商
    - [x] 实现 Prompt 构建（systemPrompt + messages）
    - [x] 实现错误处理和重试机制（最多重试 2 次，指数退避）
    - [x] 实现超时处理（30 秒）
    - [x] 支持从事件列表自动转换为消息格式

- [ ] **阶段 4：对话功能（发送消息）**（下一步）

  - [x] 任务 2.0：创建 EventRepository（repositories/EventRepository.js，使用内存存储）✅
    - [x] 实现 Session 管理（中心化存储 + 参与者索引）
    - [x] 实现 Event 管理（中心化存储 + 会话索引）
    - [x] 实现参与者标准化排序
    - [x] 实现单会话模式（同一参与者组合只有一个会话）
    - [x] 预留未来功能（主题筛选等）
  - [x] 任务 2.1：创建 EventService（services/EventService.js）✅
    - [x] 实现事件创建和查询方法
    - [x] 实现会话管理方法
    - [x] 实现事件数据验证
    - [x] 实现业务规则检查
    - [x] 预留未来功能（主题筛选，已实现但未使用）
  - [x] 任务 2.2：创建 LLMService（services/LLMService.js）✅
    - [x] 集成 LLM API（支持 OpenAI、DeepSeek、OpenRouter）
    - [x] 实现 Prompt 构建（systemPrompt + messages）
    - [x] 实现错误处理和重试机制（最多重试 2 次，指数退避）
    - [x] 实现超时处理（30 秒）
    - [x] 支持从事件列表自动转换为消息格式
  - [x] 任务 2.3：创建 MessageService（services/MessageService.js）✅
    - [x] 实现 sendMessage 方法（核心编排）
    - [x] 实现完整的消息发送流程（8 个步骤）
    - [x] 设计决策：先同步创建用户消息 Event，然后异步调用 LLM，最后同步创建 Agent 回复 Event
    - [x] Session 单会话模式：同一参与者组合只有一个 Session，用户 A 再次和 Agent B 对话会复用同一个 Session
  - [x] 任务 2.4：创建消息路由（routes/messages.js）✅
    - [x] 实现 POST /api/v1/messages 接口
    - [x] 实现统一响应格式和错误处理
    - [x] 在 server.js 中注册路由
  - [x] 验收：能发送消息并收到 AI 回复（使用内存存储）✅

- [x] **阶段 5：对话历史**（已完成 ✅）
  - [x] 任务 2.5：创建历史路由（routes/history.js）✅
    - [x] 在 EventService 中添加 getHistoryByUserAndAgent 方法
    - [x] 实现 GET /api/v1/history 接口（获取特定 Agent 的对话历史）
    - [x] 实现统一响应格式和错误处理
    - [x] 在 server.js 中注册路由
  - [x] 任务 2.6：创建会话列表路由（routes/sessions.js）✅
    - [x] 实现 GET /api/v1/sessions 接口（获取用户的所有会话列表）
    - [x] 为每个会话补充 Agent 信息
    - [x] 实现统一响应格式和错误处理
    - [x] 在 server.js 中注册路由
  - [x] 验收：能获取对话历史（使用内存数据）✅

### 前端开发任务

- [x] **阶段 7：项目准备**（已完成 ✅）

  - [x] 任务 7.1：原型设计（原型设计.md）
  - [x] 任务 7.2：UI 库选择（Ant Design）
  - [x] 任务 7.3：Mock API 设计（API 适配层架构）
  - [x] 任务 7.4：API 适配层设计（adapter.js, mockAdapter.js, httpAdapter.js）

- [x] **阶段 8：Mock API 和 API 适配层**（已完成 ✅）

  - [x] 任务 8.1：创建 API 适配器接口（adapter.js）
  - [x] 任务 8.2：实现 Mock 适配器（mockAdapter.js）
  - [x] 任务 8.3：实现 HTTP 适配器框架（httpAdapter.js）
  - [x] 任务 8.4：创建 API 入口（index.js）
  - [x] 任务 8.5：创建 API 文档（api/README.md）

- [x] **阶段 9：路由和基础组件**（已完成 ✅）

  - [x] 任务 9.1：配置路由系统（router/index.jsx）
  - [x] 任务 9.2：实现基础组件（Button、Input、Card、Loading）

- [x] **阶段 10：NPC 列表页面**（已完成 ✅）

  - [x] 任务 10.1：实现 NPC 列表页的 Mock 数据（mocks/data/agents.js）
  - [x] 任务 10.2：实现 NPC 卡片组件（components/AgentCard/AgentCard.jsx）
  - [x] 任务 10.3：实现 NPC 列表页面（pages/AgentList/AgentList.jsx）

- [x] **阶段 11：创建 NPC 页面**（已完成 ✅）

  - [x] 任务 11.1：实现创建 NPC 页的 Mock 数据（更新 mockAdapter.js）
  - [x] 任务 11.2：实现创建 NPC 页面（pages/CreateAgent/CreateAgent.jsx）
  - [x] 任务 11.3：更新路由配置

- [x] **阶段 12：对话页面**（已完成 ✅）

  - [x] 任务 12.1：实现对话页的 Mock 数据（mocks/data/history.js）
  - [x] 任务 12.2：实现消息气泡组件（components/MessageBubble/MessageBubble.jsx）
  - [x] 任务 12.3：实现对话页面布局（pages/Chat/Chat.jsx）
  - [x] 任务 12.4：实现对话历史加载和展示
  - [x] 任务 12.5：实现消息发送功能

- [x] **阶段 13：对接真实 API 和优化**（已完成 ✅）

  - [x] 任务 13.1：实现 HTTP 适配器（对接真实后端 API）✅
    - [x] 实现统一的 request 方法，处理所有 HTTP 请求
    - [x] 实现所有 API 接口（agents、messages、history、sessions）
    - [x] 实现数据格式适配（后端格式 → 前端格式）
    - [x] 实现错误处理（网络错误、HTTP 错误、业务错误）
  - [x] 任务 13.2：创建 API 测试页面 ✅
    - [x] 创建测试页面（pages/ApiTest/ApiTest.jsx）
    - [x] 实现所有接口的测试功能
    - [x] 添加测试路由（/test）
  - [x] 任务 13.3：响应式设计实现（移动端自适应）✅
    - [x] 更新全局样式（index.css），添加移动端响应式设计
    - [x] 优化 AgentList 页面移动端布局（Header、Content、按钮）
    - [x] 优化 Chat 页面移动端布局（Header、Content、Footer、输入框）
    - [x] 优化 CreateAgent 页面移动端布局（Header、Content）
    - [x] 优化 AgentCard 组件移动端显示（头像、字体、间距）
    - [x] 优化 MessageBubble 组件移动端显示（气泡宽度、字体、Markdown 内容）
    - [x] 创建各页面和组件的 CSS Modules 样式文件
    - [x] 实现响应式断点：桌面端（>768px）、平板端（768px-480px）、移动端（<480px）
  - [ ] 任务 13.4：错误处理和用户提示优化（待优化）

- [x] **阶段 14：用户认证功能**（已完成 ✅）
  - [x] 任务 14.1：后端用户认证 API ✅
    - [x] 创建 UserRepository（用户数据访问层，内存存储）
    - [x] 创建 UserService（用户业务逻辑层：登录、注册）
    - [x] 创建 users 路由（POST /api/v1/users/login, POST /api/v1/users/register）
    - [x] 在 server.js 中注册用户路由
  - [x] 任务 14.2：前端 API 适配层 ✅
    - [x] 更新 adapter.js，添加 users API 接口定义
    - [x] 更新 httpAdapter.js，实现 users.login 和 users.register
    - [x] 更新 mockAdapter.js，实现 Mock 版本的登录和注册
  - [x] 任务 14.3：前端状态管理 ✅
    - [x] 创建 AuthContext（全局用户认证状态管理）
    - [x] 实现 login、register、logout 方法
    - [x] 使用 localStorage 持久化登录状态
    - [x] 在 main.jsx 中用 AuthProvider 包裹应用
  - [x] 任务 14.4：前端 UI 组件 ✅
    - [x] 创建 LoginModal（登录弹窗组件）
    - [x] 创建 Register 页面（注册页面，包含 User ID、昵称、密码字段）
    - [x] 添加 /register 路由
  - [x] 任务 14.5：集成到 NPC 列表页 ✅
    - [x] 修改 AgentList Header，添加登录/注册按钮（未登录时）
    - [x] 显示用户昵称和头像（已登录时）
    - [x] 使用 user.id 替换硬编码的 'user_123'
    - [x] 未登录时显示友好提示，不加载数据

- [x] **阶段 15：消息发送优化和渲染增强**（已完成 ✅）
  - [x] 任务 15.1：实现短轮询方案 ✅
    - [x] 修改后端消息发送 API：改为异步处理，立即返回用户消息 Event ID
    - [x] 添加后端检查新消息 API：GET /api/v1/messages/check（用于轮询）
    - [x] 修改前端消息发送逻辑：发送后立即返回，开始轮询
    - [x] 实现前端轮询逻辑：每 5 秒检查一次新消息，收到后停止轮询
    - [x] 轮询超时保护：最多轮询 60 次（5 分钟），超时后提示用户
  - [x] 任务 15.2：实现 Markdown 渲染 ✅
    - [x] 安装 Markdown 渲染依赖（react-markdown, react-syntax-highlighter）
    - [x] 修改 MessageBubble 组件：Agent 消息使用 Markdown 渲染
    - [x] 添加代码高亮和复制功能：支持多种编程语言，一键复制代码
    - [x] 支持常见 Markdown 格式：标题、列表、链接、表格、引用、分隔线等
    - [x] 用户消息保持纯文本显示
  - [x] 任务 15.3：实现 AgentList 自动刷新 ✅
    - [x] 监听页面可见性变化：页面变为可见时自动刷新列表
    - [x] 监听路由变化：从聊天页返回时自动刷新列表
    - [x] 添加轻量级轮询：每 30 秒自动刷新一次（仅在页面可见时）
    - [x] 防抖优化：页面可见性刷新有 5 秒间隔，避免频繁刷新
  - [x] 任务 15.4：优化 AgentCard 消息预览 ✅
    - [x] 添加 Markdown 文本清理函数：提取纯文本预览
    - [x] 移除 Markdown 语法标记：代码块、链接、粗体、斜体等
    - [x] 限制预览长度：默认 60 字符，超出显示省略号
  - [x] 任务 15.5：取消 systemPrompt 长度限制 ✅
    - [x] 修改后端验证：移除 systemPrompt 最小长度限制（10 字符）
    - [x] 修改前端验证：移除 systemPrompt 必填和最小长度限制
    - [x] 更新提示文本：说明 systemPrompt 为可选字段

**详细计划**：请查看 [前端开发计划.md](./前端开发计划.md)

### 数据库迁移任务（已完成 ✅）

- [x] 任务 DB-1：安装 mysql2 依赖包（2025-11-21）✅
- [x] 任务 DB-2：初始化数据库（运行 SQL 脚本创建表结构）（2025-11-21）✅
- [x] 任务 DB-3：迁移 UserRepository 从内存存储到 MySQL（2025-11-21）✅
- [x] 任务 DB-4：迁移 AgentRepository 从内存存储到 MySQL（2025-11-21）✅
- [x] 任务 DB-5：迁移 EventRepository 和 SessionRepository 到 MySQL（2025-11-21）✅
- [x] 任务 DB-6：测试数据库连接和基本 CRUD 操作（2025-11-21）✅

### 延后任务（待后端核心功能完成后再做）

- [ ] 任务 0.6：安装 Docker Desktop（延后，用于部署和容器化）
- [ ] 任务 0.2：安装开发环境软件（部分完成）
  - [x] Node.js（v18+）
  - [x] MySQL（已安装，暂不配置连接）
  - [ ] Insomnia（可选，用于 API 测试）
  - [ ] ~~Docker Desktop~~（暂缓）

---

## 技术栈选择

- **前端框架**：React
- **后端框架**：Node.js + Express.js（已确定）
- **数据库**：MySQL
- **IDE**：Cursor + Trae
- **测试工具**：Insomnia
- **容器化**：Docker
- **Node.js 版本**：已安装（最新版）

---

## 备注

- 开发环境：Windows 11
- 开发环境配置指南：已创建 `开发环境配置指南.md`
- 项目结构演进指南：已创建并扩展 `项目结构演进指南.md`
  - 包含前后端完整结构演进（后端阶段 0-6，前端阶段 7-12）
  - 添加快速查找索引（按功能、任务、页面查找）
  - 添加完整映射总览表（功能 → 阶段 → 任务 → 文档）
  - 每个阶段都有详细的文档链接
- 已安装软件：Node.js（最新版）、MySQL（已安装但暂不配置连接）
- 待安装软件：Insomnia（可选，用于 API 测试）
- Docker：暂缓安装，初期开发不需要，稍后再安装用于部署和容器化
- **开发策略调整**：
  - 先使用内存数据存储实现后端 API 功能
  - 完成核心功能后再配置数据库连接
  - 这样可以先验证 API 逻辑和接口设计，再迁移到数据库
- **阶段 1 实现细节**：
  - 存储结构：方案 C（独立存储 + 用户关系索引）
  - ID 生成：`agent_${timestamp}_${random}`
  - 模型验证：从环境变量 MODELS 读取（格式：模型名:提供商,模型名:提供商）
  - 数据持久化：开发阶段每次重启清空（内存存储）
  - **userNameIndex 处理**：
    - 保留代码但不使用：虽然已实现 userNameIndex，但当前阶段不使用
    - 原因：单个用户的 Agent 数量不会太多，遍历 agentsByUser 的性能开销可接受
    - 当前实现：使用 agentsByUser 遍历检查名称唯一性（O(n) 查询）
    - 未来扩展：如果用户 Agent 数量增加，可以启用 userNameIndex 以获得 O(1) 查询性能
- **阶段 4 实现细节**：
  - **MessageService 设计决策**：
    - 先同步创建用户消息 Event（保证历史事件完整）
    - 然后异步调用 LLM（在等待期间可以做其他事情）
    - LLM 返回后，同步创建 Agent 回复 Event
  - **Session 单会话模式**：
    - 同一参与者组合（用户 + Agent）只有一个 Session
    - 用户 A 再次和 Agent B 对话，会复用同一个 Session
    - 未来扩展：支持主题自动拆分，将一个 Session 拆分成多个子 Session
- **测试结果**：
  - ✅ 创建 NPC API 测试通过
  - ✅ 获取列表 API 测试通过
  - ✅ 名称唯一性验证测试通过
  - ✅ 字段验证测试通过
  - ✅ 多用户支持测试通过
- **前端实现细节**：
  - **API 适配层架构**：
    - 使用适配器模式，前端维护统一的 API 接口
    - Mock 适配器使用前端 API 格式，HTTP 适配器调用后端 API 并适配格式
    - 通过环境变量 `VITE_API_MODE` 切换 Mock/HTTP 模式
  - **组件封装**：
    - 基于 Ant Design 封装业务组件（Button、Input、Card、Loading）
    - 保持组件接口简洁，符合项目规范
  - **页面实现**：
    - NPC 列表页：横行布局，创建按钮置顶
    - 创建 NPC 页：完整表单验证，错误处理
    - 对话页：消息气泡、历史加载、实时发送、自动滚动
  - **Mock 数据**：
    - 使用内存数据模拟后端 API
    - 支持延迟模拟、错误模拟
    - 数据格式符合 API 设计文档
  - **HTTP 适配器**：
    - 实现统一的 request 方法，处理所有 HTTP 请求
    - 自动适配后端数据格式到前端统一格式
    - 完善的错误处理（网络错误、HTTP 错误、业务错误）
    - 支持通过环境变量切换 Mock/HTTP 模式
  - **API 测试**：
    - 创建了专门的测试页面（/test）
    - 支持测试所有 API 接口
    - 显示详细的测试结果和错误信息
  - **用户认证功能**：
    - 后端：实现了用户登录和注册 API，使用内存存储（后续迁移到数据库）
    - 前端：实现了完整的用户认证 UI，包括登录弹窗、注册页面、状态管理
    - 数据隔离：每个用户只能看到自己创建的 NPC，通过 user.id 过滤数据
    - 持久化：登录状态保存在 localStorage，刷新页面不丢失
    - 用户体验：未登录时显示友好提示，登录后自动加载数据
  - **移动端自适应**：
    - 使用 CSS Modules 实现样式隔离和响应式设计
    - 响应式断点：桌面端（>768px）、平板端（768px-480px）、移动端（<480px）
    - 优化内容：所有页面和组件的布局、字体、间距、头像大小等
    - AgentList：移动端隐藏用户名和注册按钮，优化创建按钮大小
    - Chat：移动端优化输入框和按钮，调整消息气泡宽度
    - CreateAgent：移动端优化表单布局和间距
    - AgentCard：移动端缩小头像和字体，优化卡片内边距
    - MessageBubble：移动端调整气泡宽度和字体大小，优化 Markdown 渲染
- 其他说明：待补充

---

## 更新日志

| 日期       | 更新内容                                                                             |
| ---------- | ------------------------------------------------------------------------------------ |
| 2025-11-19 | 创建进度记录文档                                                                     |
| 2025-11-19 | 开始配置开发环境，创建配置指南                                                       |
| 2025-11-19 | 规范：记录日志时先通过工具获取当天时间，确保准确                                     |
| 2025-11-19 | 确定技术栈：React + Node.js + MySQL + Docker                                         |
| 2025-11-20 | Docker 暂缓安装，初期开发不需要，先进行其他任务                                      |
| 2025-11-20 | Node.js 和 MySQL 已安装完成，准备初始化后端项目                                      |
| 2025-11-20 | 创建项目结构演进指南，明确按需添加结构的标准和验收条件                               |
| 2025-11-20 | 扩展项目结构演进指南：添加前端结构演进、完整映射总览表、快速查找索引                 |
| 2025-11-20 | 完成后端阶段 0：初始化后端项目，创建基础文件结构                                     |
| 2025-11-20 | 完成前端阶段 7：初始化前端项目，创建 React + Vite 项目结构                           |
| 2025-11-20 | 创建一键启动脚本：根目录 package.json 和 start.js，支持 `npm run dev` 同时启动前后端 |
| 2025-11-20 | 调整开发策略：先进行后端 API 开发（使用内存数据），数据库连接和 Docker 配置延后      |
| 2025-11-20 | 完成后端阶段 1：创建 NPC API，实现完整的创建和列表功能，所有测试通过 ✅              |
| 2025-11-20 | 完成阶段 4 部分任务：创建 EventRepository，实现 Session 和 Event 的内存存储 ✅       |
| 2025-11-20 | 完成阶段 4 任务 2.1：创建 EventService，实现事件和会话的业务逻辑层 ✅                |
| 2025-11-20 | 完成阶段 4 任务 2.2：创建 LLMService，支持 OpenAI、DeepSeek、OpenRouter ✅           |
| 2025-11-21 | 完成阶段 4 任务 2.3：创建 MessageService，实现消息发送流程编排 ✅                    |
| 2025-11-21 | 完成阶段 4 任务 2.4：创建 messages 路由，实现 POST /api/v1/messages 接口 ✅          |
| 2025-11-21 | 完成阶段 4 验收：能发送消息并收到 AI 回复（使用内存存储）✅                          |
| 2025-11-21 | 完成阶段 5 任务 2.5：创建 history 路由，实现 GET /api/v1/history 接口 ✅             |
| 2025-11-21 | 完成阶段 5 任务 2.6：创建 sessions 路由，实现 GET /api/v1/sessions 接口 ✅           |
| 2025-11-21 | 优化 GET /api/v1/agents 接口：添加 lastMessageAt 字段和正确排序 ✅                   |
| 2025-11-21 | 创建前端开发计划文档：详细规划前端开发任务和阶段 ✅                                  |
| 2025-11-21 | 完成前端阶段 7-8：项目准备、Mock API 和 API 适配层 ✅                                |
| 2025-11-21 | 完成前端阶段 9：路由和基础组件（Button、Input、Card、Loading）✅                     |
| 2025-11-21 | 完成前端阶段 10：NPC 列表页面（Mock 数据、卡片组件、列表页面）✅                     |
| 2025-11-21 | 完成前端阶段 11：创建 NPC 页面（Mock 数据、表单页面）✅                              |
| 2025-11-21 | 完成前端阶段 12：对话页面（Mock 数据、消息气泡、历史加载、消息发送）✅               |
| 2025-11-21 | 完成前端阶段 13：对接真实 API（HTTP 适配器、数据格式适配、错误处理）✅               |
| 2025-11-21 | 创建 API 测试页面：支持测试所有接口，验证 API 对接是否正常 ✅                        |
| 2025-11-21 | 完成后端用户认证功能：UserRepository、UserService、用户路由（登录/注册）✅           |
| 2025-11-21 | 完成前端用户认证功能：AuthContext、LoginModal、Register 页面、集成到 AgentList ✅    |
| 2025-11-21 | 完成数据库迁移：安装 mysql2、初始化数据库、迁移所有 Repository 层到 MySQL ✅       |
| 2025-11-21 | 数据库迁移测试通过：所有 Repository 的 CRUD 操作验证成功 ✅                          |
| 2025-01-22 | 实现短轮询方案：消息发送改为异步处理，前端轮询检查新消息 ✅                          |
| 2025-01-22 | 实现 Markdown 渲染：Agent 消息支持代码高亮、列表、链接、表格等格式 ✅                |
| 2025-01-22 | 实现 AgentList 自动刷新：页面可见性变化、路由返回、定期轮询自动刷新 ✅                 |
| 2025-01-22 | 取消 systemPrompt 长度限制：前后端均支持可选且可为空 ✅                              |
| 2025-11-22 | 完成阶段 5 验收：对话历史功能测试通过，能正常获取对话历史（使用数据库）✅           |
| 2025-11-22 | 完成移动端自适应：优化所有页面和组件的移动端显示，实现响应式设计 ✅                |
